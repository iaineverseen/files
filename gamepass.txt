local lib = loadstring(game:HttpGet('https://raw.githubusercontent.com/iaineverseen/files/refs/heads/main/source.txt'))()

local MarketplaceService = game:GetService("MarketplaceService")
local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local localPlayer = Players.LocalPlayer

local Window = lib:Window("Free Product Finder", Color3.fromRGB(44, 120, 224), Enum.KeyCode.RightControl)

local selectedGamePass = nil
local gamePassesList = {}
local loopPurchaseEnabled = false
local loopPurchaseTask = nil
local loopPurchaseSpeed = 0.1

-- Safe clipboard function
local function SafeSetClipboard(text)
    if setclipboard then
        pcall(setclipboard, tostring(text))
    end
end

local function GetGamePasses()
    gamePassesList = {}
    
    local success, productsPage = pcall(function()
        return MarketplaceService:GetDeveloperProductsAsync()
    end)

    if success and productsPage then
        local currentPage = productsPage:GetCurrentPage()
        if currentPage then
            for _, productInfo in ipairs(currentPage) do
                if productInfo and productInfo.ProductId then
                    table.insert(gamePassesList, {
                        Name = productInfo.Name or "Unnamed",
                        ID = productInfo.ProductId,
                        Description = productInfo.Description or "",
                        Price = productInfo.PriceInRobux or 0
                    })
                end
            end
        end
    end
    
    local passNames = {}
    for _, pass in ipairs(gamePassesList) do
        if pass.Name then
            table.insert(passNames, pass.Name)
        end
    end
    
    if #passNames == 0 then
        table.insert(passNames, "No GamePasses Found")
    end
    
    return passNames
end

local function PurchaseGamePass(gamePassId)
    if not gamePassId then
        return false, "Invalid GamePass ID"
    end
    
    local success, message = pcall(function()
        MarketplaceService:SignalPromptProductPurchaseFinished(localPlayer.UserId, gamePassId, true)
        return true
    end)
    
    return success, message
end

local function PurchaseAllGamePasses()
    GetGamePasses()
    
    for _, gamePass in ipairs(gamePassesList) do
        if gamePass.ID then
            PurchaseGamePass(gamePass.ID)
        end
    end
end

local function StartLoopPurchase()
    if loopPurchaseTask then
        loopPurchaseTask:Disconnect()
        loopPurchaseTask = nil
    end
    
    if not selectedGamePass or not selectedGamePass.ID then
        loopPurchaseEnabled = false
        return
    end
    
    loopPurchaseTask = RunService.Heartbeat:Connect(function()
        if loopPurchaseEnabled and selectedGamePass and selectedGamePass.ID then
            PurchaseGamePass(selectedGamePass.ID)
            task.wait(loopPurchaseSpeed)
        elseif not loopPurchaseEnabled and loopPurchaseTask then
            loopPurchaseTask:Disconnect()
            loopPurchaseTask = nil
        end
    end)
end

local function StopLoopPurchase()
    loopPurchaseEnabled = false
    if loopPurchaseTask then
        loopPurchaseTask:Disconnect()
        loopPurchaseTask = nil
    end
end

local function RefreshGamePassList()
    GetGamePasses()
    StopLoopPurchase()
end

-- Create UI
local MainTab = Window:Tab("Main")

local dropdownOptions = GetGamePasses()

MainTab:Dropdown("Select Game Pass", dropdownOptions, function(selected)
    selectedGamePass = nil
    for _, pass in ipairs(gamePassesList) do
        if pass.Name == selected then
            selectedGamePass = pass
            break
        end
    end
    
    StopLoopPurchase()
end)

MainTab:Button("Buy Selected Game Pass", function()
    if selectedGamePass and selectedGamePass.ID then
        PurchaseGamePass(selectedGamePass.ID)
    end
end)

MainTab:Button("Buy All Game Passes", function()
    PurchaseAllGamePasses()
end)

MainTab:Toggle("Loop Buy Selected Game Pass", false, function(state)
    loopPurchaseEnabled = state
    
    if state then
        if selectedGamePass and selectedGamePass.ID then
            StartLoopPurchase()
        else
            loopPurchaseEnabled = false
        end
    else
        StopLoopPurchase()
    end
end)

MainTab:Slider("Loop Buy Speed", 0.01, 1, 0.01, function(value)
    loopPurchaseSpeed = value
end)

MainTab:Button("Refresh Game Pass List", function()
    RefreshGamePassList()
end)

MainTab:Button("Copy Selected Game Pass ID", function()
    if selectedGamePass and selectedGamePass.ID then
        SafeSetClipboard(tostring(selectedGamePass.ID))
    end
end)
