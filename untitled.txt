local CoreGui = cloneref(game:GetService("CoreGui"))
local TweenService = cloneref(game:GetService("TweenService"))
local UserInputService = cloneref(game:GetService("UserInputService"))

-- Cached assets
local ASSETS = {
    SHADOW = "rbxassetid://5554236805",
    LOGO = "rbxassetid://7803241868",
    MINIMIZE = "rbxassetid://121304296213645",
    CHECK = "rbxassetid://7812909048",
    ARROW = "rbxassetid://3926307971",
    ARROW_RECT_OFFSET = Vector2.new(324, 524),
    ARROW_RECT_SIZE = Vector2.new(36, 36)
}

local Colors = {
    MainBackground = Color3.fromRGB(30, 30, 30),
    TopBar = Color3.fromRGB(24, 24, 24),
    TabsBackground = Color3.fromRGB(33, 33, 33),
    ElementBackground = Color3.fromRGB(35, 35, 35),
    ElementHover = Color3.fromRGB(40, 40, 40),
    Primary = Color3.fromRGB(17, 85, 232),
    PrimaryDark = Color3.fromRGB(10, 49, 134),
    PrimaryHover = Color3.fromRGB(12, 59, 160),
    SecondaryButton = Color3.fromRGB(14, 69, 188),
    TextPrimary = Color3.fromRGB(255, 255, 255),
    TextSecondary = Color3.fromRGB(72, 72, 72),
    TextPlaceholder = Color3.fromRGB(150, 150, 150),
    DarkElement = Color3.fromRGB(43, 43, 43),
    MediumElement = Color3.fromRGB(52, 52, 52),
    MinimizeIcon = Color3.fromRGB(199, 199, 199),
}

-- Pre-calculated values
local HALF = Vector2.new(0.5, 0.5)
local CORNER_RADIUS = UDim.new(0, 6)

-- Connection pool for cleanup
local ConnectionPool = {}

local Library = {}

local function SafeDisconnect(connection)
    if connection and typeof(connection) == "RBXScriptConnection" then
        connection:Disconnect()
    end
end

local function AddToPool(connection)
    table.insert(ConnectionPool, connection)
end

local function CleanupPool()
    for _, conn in ipairs(ConnectionPool) do
        SafeDisconnect(conn)
    end
    ConnectionPool = {}
end

function Library:Window(Title)
    local ExistingUI = CoreGui:FindFirstChild("SentinelLib")
    if ExistingUI then
        warn("Sentinel already exists! Destroying old instance and creating new one.")
        ExistingUI:Destroy()
    end
    
    CleanupPool() -- Clean old connections

    local Ui = Instance.new("ScreenGui")
    Ui.Name = "SentinelLib"
    Ui.Parent = CoreGui
    Ui.ResetOnSpawn = false
    Ui.ZIndexBehavior = Enum.ZIndexBehavior.Global

    local Main = Instance.new("Frame")
    Main.Name = "Main"
    Main.Parent = Ui
    Main.BackgroundColor3 = Colors.MainBackground
    Main.BorderSizePixel = 0
    Main.Size = UDim2.new(0, 470, 0, 283)
    Main.AnchorPoint = HALF
    Main.Position = UDim2.new(0.5, 0, 0.5, 0)
    Main.Active = true

    -- Dragging logic
    local Dragging, DragInput, DragStart, StartPos = false, nil, nil, Main.Position

    local function UpdateInput(Input)
        if not Dragging then return end
        local Delta = Input.Position - DragStart
        local NewPos = UDim2.new(
            StartPos.X.Scale, StartPos.X.Offset + Delta.X,
            StartPos.Y.Scale, StartPos.Y.Offset + Delta.Y
        )
        Main.Position = NewPos
        StartPos = NewPos
    end

    local dragBeginConn = Main.InputBegan:Connect(function(Input)
        if Input.UserInputType == Enum.UserInputType.MouseButton1 then
            Dragging = true
            DragStart = Input.Position
            DragInput = Input
        end
    end)
    AddToPool(dragBeginConn)

    local dragChangedConn = Main.InputChanged:Connect(function(Input)
        if Input.UserInputType == Enum.UserInputType.MouseMovement then
            DragInput = Input
        end
    end)
    AddToPool(dragChangedConn)

    local inputChangedConn = UserInputService.InputChanged:Connect(function(Input)
        if Dragging and Input == DragInput then
            UpdateInput(Input)
        end
    end)
    AddToPool(inputChangedConn)

    local inputEndedConn = UserInputService.InputEnded:Connect(function(Input)
        if Input.UserInputType == Enum.UserInputType.MouseButton1 then
            Dragging = false
        end
    end)
    AddToPool(inputEndedConn)

    local UiCorner = Instance.new("UICorner")
    UiCorner.CornerRadius = CORNER_RADIUS
    UiCorner.Parent = Main

    local Shadow = Instance.new("ImageLabel")
    Shadow.Name = "Shadow"
    Shadow.Parent = Main
    Shadow.AnchorPoint = HALF
    Shadow.BackgroundTransparency = 1
    Shadow.Position = UDim2.new(0.5, 0, 0.5, 0)
    Shadow.Size = UDim2.new(1, 30, 1, 30)
    Shadow.ZIndex = -1
    Shadow.Image = ASSETS.SHADOW
    Shadow.ImageColor3 = Color3.new(0, 0, 0)
    Shadow.ScaleType = Enum.ScaleType.Slice
    Shadow.SliceCenter = Rect.new(23, 23, 277, 277)

    local Top = Instance.new("Frame")
    Top.Name = "Top"
    Top.Parent = Main
    Top.BackgroundColor3 = Colors.TopBar
    Top.BorderSizePixel = 0
    Top.Size = UDim2.new(1, 0, 0, 34)

    local TopCorner = Instance.new("UICorner")
    TopCorner.CornerRadius = CORNER_RADIUS
    TopCorner.Parent = Top

    local TopCover = Instance.new("Frame")
    TopCover.Name = "Cover"
    TopCover.Parent = Top
    TopCover.AnchorPoint = Vector2.new(0.5, 1)
    TopCover.BackgroundColor3 = Colors.TopBar
    TopCover.BorderSizePixel = 0
    TopCover.Position = UDim2.new(0.5, 0, 1, 0)
    TopCover.Size = UDim2.new(1, 0, 0, 4)

    local Line = Instance.new("Frame")
    Line.Name = "Line"
    Line.Parent = Top
    Line.AnchorPoint = Vector2.new(0.5, 1)
    Line.BackgroundColor3 = Color3.new(1, 1, 1)
    Line.BackgroundTransparency = 0.92
    Line.Position = UDim2.new(0.5, 0, 1, 1)
    Line.Size = UDim2.new(1, 0, 0, 1)

    local Logo = Instance.new("ImageLabel")
    Logo.Name = "Logo"
    Logo.Parent = Top
    Logo.AnchorPoint = Vector2.new(0, 0.5)
    Logo.BackgroundTransparency = 1
    Logo.Position = UDim2.new(0, 4, 0.5, 0)
    Logo.Size = UDim2.new(0, 26, 0, 30)
    Logo.Image = ASSETS.LOGO
    Logo.ImageColor3 = Colors.Primary

    local Minimize = Instance.new("ImageButton")
    Minimize.Name = "Minimize"
    Minimize.Parent = Top
    Minimize.AnchorPoint = Vector2.new(1, 0.5)
    Minimize.BackgroundTransparency = 1
    Minimize.Position = UDim2.new(1, -6, 0.5, 0)
    Minimize.Size = UDim2.new(0, 20, 0, 20)
    Minimize.Image = ASSETS.MINIMIZE
    Minimize.ImageColor3 = Colors.MinimizeIcon
    Minimize.ScaleType = Enum.ScaleType.Crop

    local MinimizedIcon = Instance.new("ImageButton")
    MinimizedIcon.Name = "MinimizedIcon"
    MinimizedIcon.Parent = Ui
    MinimizedIcon.AnchorPoint = Vector2.new(1, 0)
    MinimizedIcon.BackgroundColor3 = Colors.Primary
    MinimizedIcon.BorderSizePixel = 0
    MinimizedIcon.Position = UDim2.new(1, -20, 0, 20)
    MinimizedIcon.Size = UDim2.new(0, 40, 0, 40)
    MinimizedIcon.Visible = false
    MinimizedIcon.ZIndex = 100
    MinimizedIcon.Image = ASSETS.LOGO

    local MinimizedIconCorner = Instance.new("UICorner")
    MinimizedIconCorner.CornerRadius = UDim.new(0, 8)
    MinimizedIconCorner.Parent = MinimizedIcon

    -- Minimized icon dragging
    local MinDragging, MinDragInput, MinDragStart, MinStartPos = false, nil, nil, nil

    local function UpdateMinInput(Input)
        if not MinDragging then return end
        local Delta = Input.Position - MinDragStart
        MinimizedIcon.Position = UDim2.new(
            MinStartPos.X.Scale, MinStartPos.X.Offset + Delta.X,
            MinStartPos.Y.Scale, MinStartPos.Y.Offset + Delta.Y
        )
    end

    local minDragConn = MinimizedIcon.InputBegan:Connect(function(Input)
        if Input.UserInputType == Enum.UserInputType.MouseButton1 then
            MinDragging = true
            MinDragStart = Input.Position
            MinStartPos = MinimizedIcon.Position
            MinDragInput = Input
        end
    end)
    AddToPool(minDragConn)

    local minInputConn = MinimizedIcon.InputChanged:Connect(function(Input)
        if Input.UserInputType == Enum.UserInputType.MouseMovement then
            MinDragInput = Input
        end
    end)
    AddToPool(minInputConn)

    local minChangedConn = UserInputService.InputChanged:Connect(function(Input)
        if MinDragging and Input == MinDragInput then
            UpdateMinInput(Input)
        end
    end)
    AddToPool(minChangedConn)

    local minEndConn = UserInputService.InputEnded:Connect(function(Input)
        if Input.UserInputType == Enum.UserInputType.MouseButton1 then
            MinDragging = false
        end
    end)
    AddToPool(minEndConn)

    local minimizeClickConn = Minimize.MouseButton1Click:Connect(function()
        Main.Visible = false
        MinimizedIcon.Visible = true
    end)
    AddToPool(minimizeClickConn)

    local minimizeEnterConn = Minimize.MouseEnter:Connect(function()
        TweenService:Create(Minimize, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            ImageColor3 = Colors.TextPrimary
        }):Play()
    end)
    AddToPool(minimizeEnterConn)

    local minimizeLeaveConn = Minimize.MouseLeave:Connect(function()
        TweenService:Create(Minimize, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
            ImageColor3 = Color3.fromRGB(166, 166, 166)
        }):Play()
    end)
    AddToPool(minimizeLeaveConn)

    local iconClickConn = MinimizedIcon.MouseButton1Click:Connect(function()
        Main.Visible = true
        MinimizedIcon.Visible = false
    end)
    AddToPool(iconClickConn)

    local GameName = Instance.new("TextLabel")
    GameName.Name = "GameName"
    GameName.Parent = Top
    GameName.AnchorPoint = Vector2.new(0, 0.5)
    GameName.BackgroundTransparency = 1
    GameName.Position = UDim2.new(0, 32, 0.5, 0)
    GameName.Size = UDim2.new(0, 165, 0, 22)
    GameName.Font = Enum.Font.Gotham
    GameName.Text = Title or "SentinelLib"
    GameName.TextColor3 = Colors.Primary
    GameName.TextSize = 14
    GameName.TextXAlignment = Enum.TextXAlignment.Left

    local Tabs = Instance.new("Frame")
    Tabs.Name = "Tabs"
    Tabs.Parent = Main
    Tabs.BackgroundColor3 = Colors.TabsBackground
    Tabs.BorderSizePixel = 0
    Tabs.Position = UDim2.new(0, 0, 0, 35)
    Tabs.Size = UDim2.new(0, 122, 1, -35)

    local TabsCorner = Instance.new("UICorner")
    TabsCorner.CornerRadius = CORNER_RADIUS
    TabsCorner.Parent = Tabs

    local TabsCover = Instance.new("Frame")
    TabsCover.Name = "Cover"
    TabsCover.Parent = Tabs
    TabsCover.AnchorPoint = Vector2.new(1, 0.5)
    TabsCover.BackgroundColor3 = Colors.TabsBackground
    TabsCover.BorderSizePixel = 0
    TabsCover.Position = UDim2.new(1, 0, 0.5, 0)
    TabsCover.Size = UDim2.new(0, 5, 1, 0)

    local TabsContainer = Instance.new("ScrollingFrame")
    TabsContainer.Name = "TabsContainer"
    TabsContainer.Parent = Tabs
    TabsContainer.BackgroundTransparency = 1
    TabsContainer.Size = UDim2.new(1, 0, 1, 0)
    TabsContainer.CanvasSize = UDim2.new(0, 0, 0, 0)
    TabsContainer.ScrollBarThickness = 0
    TabsContainer.ScrollBarImageTransparency = 1
    TabsContainer.AutomaticCanvasSize = Enum.AutomaticSize.Y

    local TabsList = Instance.new("UIListLayout")
    TabsList.Name = "TabsList"
    TabsList.Parent = TabsContainer
    TabsList.HorizontalAlignment = Enum.HorizontalAlignment.Center
    TabsList.SortOrder = Enum.SortOrder.LayoutOrder
    TabsList.Padding = UDim.new(0, 5)

    local TabsPadding = Instance.new("UIPadding")
    TabsPadding.Parent = TabsContainer
    TabsPadding.PaddingTop = UDim.new(0, 5)

    local Pages = Instance.new("Frame")
    Pages.Name = "Pages"
    Pages.Parent = Main
    Pages.BackgroundColor3 = Colors.MainBackground
    Pages.BorderSizePixel = 0
    Pages.Position = UDim2.new(0, 130, 0, 42)
    Pages.Size = UDim2.new(1, -138, 1, -50)

    local PagesCorner = Instance.new("UICorner")
    PagesCorner.CornerRadius = CORNER_RADIUS
    PagesCorner.Parent = Pages

    local TabFunctions = {}
    local FirstTabCreated = false

    function TabFunctions:Tab(TabTitle)
        local TitleText = TabTitle or "Tab"
        local TabButton = Instance.new("TextButton")
        TabButton.Name = "TabButton"
        TabButton.Parent = TabsContainer
        TabButton.BackgroundColor3 = Colors.Primary
        TabButton.BackgroundTransparency = 1
        TabButton.Size = UDim2.new(1, -12, 0, 30)
        TabButton.AutoButtonColor = false
        TabButton.Font = Enum.Font.Gotham
        TabButton.Text = ""
        TabButton.TextColor3 = Colors.TextSecondary
        TabButton.TextSize = 14

        local TabCorner = Instance.new("UICorner")
        TabCorner.CornerRadius = CORNER_RADIUS
        TabCorner.Parent = TabButton

        local TextLabel = Instance.new("TextLabel")
        TextLabel.Name = "TextLabel"
        TextLabel.Parent = TabButton
        TextLabel.BackgroundTransparency = 1
        TextLabel.Size = UDim2.new(1, 0, 1, 0)
        TextLabel.Font = Enum.Font.Gotham
        TextLabel.Text = TitleText
        TextLabel.TextColor3 = Colors.TextSecondary
        TextLabel.TextSize = 14
        TextLabel.TextXAlignment = Enum.TextXAlignment.Center

        local Page = Instance.new("ScrollingFrame")
        Page.Name = "Page"
        Page.Visible = false
        Page.Parent = Pages
        Page.Active = true
        Page.BackgroundTransparency = 1
        Page.BorderSizePixel = 0
        Page.Size = UDim2.new(1, 0, 1, 0)
        Page.ScrollBarThickness = 0
        Page.ScrollBarImageTransparency = 1
        Page.ClipsDescendants = true
        Page.AutomaticCanvasSize = Enum.AutomaticSize.Y

        local PageList = Instance.new("UIListLayout")
        PageList.Parent = Page
        PageList.HorizontalAlignment = Enum.HorizontalAlignment.Center
        PageList.SortOrder = Enum.SortOrder.LayoutOrder
        PageList.Padding = UDim.new(0, 6)

        local PagePadding = Instance.new("UIPadding")
        PagePadding.Parent = Page
        PagePadding.PaddingTop = UDim.new(0, 5)

        local tabClickConn = TabButton.MouseButton1Click:Connect(function()
            for _, Child in next, Pages:GetChildren() do
                if Child:IsA("ScrollingFrame") then
                    Child.Visible = false
                end
            end
            Page.Visible = true
            
            for _, Child in next, TabsContainer:GetChildren() do
                if Child.Name == "TabButton" then
                    TweenService:Create(Child, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                        BackgroundTransparency = 1
                    }):Play()
                    if Child:FindFirstChild("TextLabel") then
                        TweenService:Create(Child.TextLabel, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                            TextColor3 = Colors.TextSecondary
                        }):Play()
                    end
                end
            end
            
            TweenService:Create(TabButton, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                BackgroundTransparency = 0.6
            }):Play()
            TweenService:Create(TextLabel, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                TextColor3 = Colors.TextPrimary
            }):Play()
        end)
        AddToPool(tabClickConn)

        local Elements = {}

        local function ApplyButtonHoverEffect(Button, NormalColor, HoverColor)
            local enterConn = Button.MouseEnter:Connect(function()
                TweenService:Create(Button, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                    BackgroundColor3 = HoverColor
                }):Play()
            end)
            AddToPool(enterConn)
            
            local leaveConn = Button.MouseLeave:Connect(function()
                TweenService:Create(Button, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                    BackgroundColor3 = NormalColor
                }):Play()
            end)
            AddToPool(leaveConn)
        end

        function Elements:Button(Text, Callback)
            local Button = Instance.new("TextButton")
            Button.Name = "Button"
            Button.Parent = Page
            Button.BackgroundColor3 = Colors.PrimaryDark
            Button.BorderSizePixel = 0
            Button.Size = UDim2.new(1, -6, 0, 34)
            Button.AutoButtonColor = false
            Button.Font = Enum.Font.Gotham
            Button.Text = Text or "Button"
            Button.TextColor3 = Colors.TextPrimary
            Button.TextSize = 14
            Button.TextXAlignment = Enum.TextXAlignment.Center

            local ButtonCorner = Instance.new("UICorner")
            ButtonCorner.CornerRadius = CORNER_RADIUS
            ButtonCorner.Parent = Button

            ApplyButtonHoverEffect(Button, Colors.PrimaryDark, Colors.PrimaryHover)

            local clickConn = Button.MouseButton1Click:Connect(function()
                if Callback then
                    task.spawn(Callback)
                end
            end)
            AddToPool(clickConn)
        end

        function Elements:Toggle(Text, Default, Callback)
            local Toggled = Default == true
            local Toggle = Instance.new("TextButton")
            Toggle.Name = "Toggle"
            Toggle.Parent = Page
            Toggle.BackgroundColor3 = Colors.ElementBackground
            Toggle.BorderSizePixel = 0
            Toggle.Size = UDim2.new(1, -6, 0, 34)
            Toggle.AutoButtonColor = false
            Toggle.Text = ""

            local ToggleCorner = Instance.new("UICorner")
            ToggleCorner.CornerRadius = CORNER_RADIUS
            ToggleCorner.Parent = Toggle

            local Title = Instance.new("TextLabel")
            Title.Name = "Title"
            Title.Parent = Toggle
            Title.BackgroundTransparency = 1
            Title.Position = UDim2.new(0, 8, 0, 0)
            Title.Size = UDim2.new(1, -6, 1, 0)
            Title.Font = Enum.Font.Gotham
            Title.Text = Text or "Toggle"
            Title.TextColor3 = Colors.TextPrimary
            Title.TextSize = 14
            Title.TextXAlignment = Enum.TextXAlignment.Left

            local ToggleFrame = Instance.new("Frame")
            ToggleFrame.Name = "ToggleFrame"
            ToggleFrame.Parent = Toggle
            ToggleFrame.AnchorPoint = Vector2.new(1, 0.5)
            ToggleFrame.BackgroundColor3 = Color3.fromRGB(12, 59, 161)
            ToggleFrame.BackgroundTransparency = Toggled and 0 or 1
            ToggleFrame.BorderSizePixel = 0
            ToggleFrame.Position = UDim2.new(1, -8, 0.5, 0)
            ToggleFrame.Size = UDim2.new(0, 14, 0, 14)

            local ToggleCornerTwo = Instance.new("UICorner")
            ToggleCornerTwo.CornerRadius = UDim.new(0, 3)
            ToggleCornerTwo.Parent = ToggleFrame

            local Check = Instance.new("ImageLabel")
            Check.Name = "Check"
            Check.Parent = ToggleFrame
            Check.BackgroundTransparency = 1
            Check.Position = UDim2.new(-0.214285731, 0, -0.214285731, 0)
            Check.Size = UDim2.new(0, 20, 0, 20)
            Check.Image = ASSETS.CHECK
            Check.ImageTransparency = Toggled and 0 or 1
            Check.ScaleType = Enum.ScaleType.Fit

            local ToggleStroke = Instance.new("UIStroke")
            ToggleStroke.Parent = ToggleFrame
            ToggleStroke.LineJoinMode = Enum.LineJoinMode.Round
            ToggleStroke.Thickness = 2
            ToggleStroke.Color = Color3.fromRGB(12, 59, 161)

            local enterConn = Toggle.MouseEnter:Connect(function()
                TweenService:Create(Toggle, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                    BackgroundColor3 = Colors.ElementHover
                }):Play()
            end)
            AddToPool(enterConn)

            local leaveConn = Toggle.MouseLeave:Connect(function()
                TweenService:Create(Toggle, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
                    BackgroundColor3 = Colors.ElementBackground
                }):Play()
            end)
            AddToPool(leaveConn)

            local clickConn = Toggle.MouseButton1Click:Connect(function()
                Toggled = not Toggled
                TweenService:Create(ToggleFrame, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                    BackgroundTransparency = Toggled and 0 or 1
                }):Play()
                TweenService:Create(Check, TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                    ImageTransparency = Toggled and 0 or 1
                }):Play()
                
                if Callback then
                    task.spawn(Callback, Toggled)
                end
            end)
            AddToPool(clickConn)

            local ToggleFunctions = {}
            function ToggleFunctions:Set(Value)
                if Toggled == Value then return end
                Toggled = Value
                ToggleFrame.BackgroundTransparency = Toggled and 0 or 1
                Check.ImageTransparency = Toggled and 0 or 1
                if Callback then
                    task.spawn(Callback, Toggled)
                end
            end
            return ToggleFunctions
        end

        function Elements:Label(Text)
            local Label = Instance.new("TextLabel")
            Label.Parent = Page
            Label.BackgroundColor3 = Colors.ElementBackground
            Label.BorderSizePixel = 0
            Label.Size = UDim2.new(1, -6, 0, 34)
            Label.Font = Enum.Font.Gotham
            Label.Text = Text or "Label"
            Label.TextColor3 = Colors.TextPrimary
            Label.TextSize = 14
            Label.TextXAlignment = Enum.TextXAlignment.Center

            local LabelCorner = Instance.new("UICorner")
            LabelCorner.CornerRadius = CORNER_RADIUS
            LabelCorner.Parent = Label

            local LabelFunctions = {}
            function LabelFunctions:Set(NewText)
                Label.Text = NewText or "Label"
            end
            return LabelFunctions
        end

        function Elements:Slider(Text, Min, Max, Default, Increment, Callback)
            Min = Min or 0
            Max = Max or 100
            Default = math.clamp(Default or Min, Min, Max)
            Increment = Increment or 1

            local CurrentValue = Default

            local Slider = Instance.new("Frame")
            Slider.Name = "Slider"
            Slider.Parent = Page
            Slider.BackgroundColor3 = Colors.ElementBackground
            Slider.Size = UDim2.new(1, -6, 0, 48)

            local SliderCorner = Instance.new("UICorner")
            SliderCorner.CornerRadius = CORNER_RADIUS
            SliderCorner.Parent = Slider

            local Title = Instance.new("TextLabel")
            Title.Name = "Title"
            Title.Parent = Slider
            Title.BackgroundTransparency = 1
            Title.Position = UDim2.new(0, 8, 0, 0)
            Title.Size = UDim2.new(1, -6, 0, 34)
            Title.Font = Enum.Font.Gotham
            Title.Text = Text or "Slider"
            Title.TextColor3 = Colors.TextPrimary
            Title.TextSize = 14
            Title.TextXAlignment = Enum.TextXAlignment.Left

            local Value = Instance.new("TextLabel")
            Value.Name = "Value"
            Value.Parent = Slider
            Value.AnchorPoint = Vector2.new(1, 0)
            Value.BackgroundTransparency = 1
            Value.Position = UDim2.new(1, -10, 0, 0)
            Value.Size = UDim2.new(1, 0, 0, 34)
            Value.Font = Enum.Font.Gotham
            Value.Text = tostring(CurrentValue)
            Value.TextColor3 = Colors.TextPrimary
            Value.TextSize = 14
            Value.TextXAlignment = Enum.TextXAlignment.Right

            local SliderClick = Instance.new("TextButton")
            SliderClick.Name = "SliderClick"
            SliderClick.Parent = Slider
            SliderClick.AnchorPoint = Vector2.new(0.5, 1)
            SliderClick.BackgroundColor3 = Colors.MediumElement
            SliderClick.Position = UDim2.new(0.5, 0, 1, -8)
            SliderClick.Size = UDim2.new(1, -12, 0, 6)
            SliderClick.AutoButtonColor = false
            SliderClick.Text = ""
            SliderClick.Active = true

            local SliderClickCorner = Instance.new("UICorner")
            SliderClickCorner.CornerRadius = UDim.new(0, 6)
            SliderClickCorner.Parent = SliderClick

            local SliderDrag = Instance.new("Frame")
            SliderDrag.Name = "SliderDrag"
            SliderDrag.Parent = SliderClick
            SliderDrag.BackgroundColor3 = Colors.SecondaryButton
            SliderDrag.Size = UDim2.new((CurrentValue - Min) / (Max - Min), 0, 1, 0)

            local SliderDragCorner = Instance.new("UICorner")
            SliderDragCorner.CornerRadius = UDim.new(0, 6)
            SliderDragCorner.Parent = SliderDrag

            local SliderDragging = false

            local function RoundToIncrement(value)
                return Increment == 0 and value or math.floor(value / Increment + 0.5) * Increment
            end

            local function FormatNumber(value)
                local Formatted = string.format("%.4f", value)
                Formatted = Formatted:gsub("0+$", "")
                Formatted = Formatted:gsub("%.$", "")
                return Formatted
            end

            local function UpdateSlider(Percent)
                local RawValue = Min + (Percent * (Max - Min))
                CurrentValue = RoundToIncrement(RawValue)
                local AdjustedPercent = (CurrentValue - Min) / (Max - Min)
                SliderDrag.Size = UDim2.new(AdjustedPercent, 0, 1, 0)
                Value.Text = FormatNumber(CurrentValue)
                return CurrentValue
            end

            local function HandleInputBegan(Input)
                if Input.UserInputType == Enum.UserInputType.MouseButton1 then
                    SliderDragging = true
                end
            end

            local function HandleInputChanged(Input)
                if SliderDragging and Input.UserInputType == Enum.UserInputType.MouseMovement then
                    local Percent = math.clamp(
                        (Input.Position.X - SliderClick.AbsolutePosition.X) / SliderClick.AbsoluteSize.X,
                        0, 1
                    )
                    UpdateSlider(Percent)
                end
            end

            local function HandleInputEnded(Input)
                if Input.UserInputType == Enum.UserInputType.MouseButton1 then
                    if SliderDragging and Callback then
                        task.spawn(Callback, CurrentValue)
                    end
                    SliderDragging = false
                end
            end

            local inputBeganConn = SliderClick.InputBegan:Connect(HandleInputBegan)
            AddToPool(inputBeganConn)
            
            local inputChangedConn = SliderClick.InputChanged:Connect(HandleInputChanged)
            AddToPool(inputChangedConn)
            
            local inputEndedConn = SliderClick.InputEnded:Connect(HandleInputEnded)
            AddToPool(inputEndedConn)

            local touchBeganConn = UserInputService.InputBegan:Connect(HandleInputBegan)
            AddToPool(touchBeganConn)
            
            local touchChangedConn = UserInputService.InputChanged:Connect(HandleInputChanged)
            AddToPool(touchChangedConn)
            
            local touchEndedConn = UserInputService.InputEnded:Connect(HandleInputEnded)
            AddToPool(touchEndedConn)
        end

        function Elements:InputBox(Text, Placeholder, Callback)
            local InputBox = Instance.new("Frame")
            InputBox.Name = "InputBox"
            InputBox.Parent = Page
            InputBox.BackgroundColor3 = Colors.ElementBackground
            InputBox.BorderSizePixel = 0
            InputBox.Size = UDim2.new(1, -6, 0, 34)

            local InputBoxCorner = Instance.new("UICorner")
            InputBoxCorner.CornerRadius = CORNER_RADIUS
            InputBoxCorner.Parent = InputBox

            local Title = Instance.new("TextLabel")
            Title.Name = "Title"
            Title.Parent = InputBox
            Title.BackgroundTransparency = 1
            Title.Position = UDim2.new(0, 8, 0, 0)
            Title.Size = UDim2.new(0.4, -6, 1, 0)
            Title.Font = Enum.Font.Gotham
            Title.Text = Text or "Input"
            Title.TextColor3 = Colors.TextPrimary
            Title.TextSize = 14
            Title.TextXAlignment = Enum.TextXAlignment.Left

            local BoxContainer = Instance.new("Frame")
            BoxContainer.Name = "BoxContainer"
            BoxContainer.Parent = InputBox
            BoxContainer.BackgroundTransparency = 1
            BoxContainer.AnchorPoint = Vector2.new(1, 0.5)
            BoxContainer.Position = UDim2.new(1, -6, 0.5, 0)
            BoxContainer.Size = UDim2.new(0.55, -12, 0, 24)
            BoxContainer.ClipsDescendants = true

            local Box = Instance.new("TextBox")
            Box.Name = "Box"
            Box.Parent = BoxContainer
            Box.BackgroundColor3 = Colors.DarkElement
            Box.BorderSizePixel = 0
            Box.Size = UDim2.new(1, 0, 1, 0)
            Box.Font = Enum.Font.Gotham
            Box.PlaceholderText = Placeholder or "Enter text..."
            Box.PlaceholderColor3 = Colors.TextPlaceholder
            Box.Text = ""
            Box.TextColor3 = Colors.TextPrimary
            Box.TextSize = 14
            Box.TextXAlignment = Enum.TextXAlignment.Center

            local BoxCorner = Instance.new("UICorner")
            BoxCorner.CornerRadius = UDim.new(0, 4)
            BoxCorner.Parent = Box

            local focusLostConn = Box.FocusLost:Connect(function(EnterPressed)
                if Callback and (EnterPressed or not Box:IsFocused()) then
                    task.spawn(Callback, Box.Text)
                end
            end)
            AddToPool(focusLostConn)

            local HoverFrame = Instance.new("TextButton")
            HoverFrame.Name = "HoverFrame"
            HoverFrame.Parent = InputBox
            HoverFrame.BackgroundColor3 = Colors.ElementBackground
            HoverFrame.BorderSizePixel = 0
            HoverFrame.Size = UDim2.new(1, 0, 1, 0)
            HoverFrame.AutoButtonColor = false
            HoverFrame.Text = ""
            HoverFrame.ZIndex = 0

            local hoverEnterConn = HoverFrame.MouseEnter:Connect(function()
                TweenService:Create(InputBox, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out), {
                    BackgroundColor3 = Colors.ElementHover
                }):Play()
            end)
            AddToPool(hoverEnterConn)

            local hoverLeaveConn = HoverFrame.MouseLeave:Connect(function()
                TweenService:Create(InputBox, TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.In), {
                    BackgroundColor3 = Colors.ElementBackground
                }):Play()
            end)
            AddToPool(hoverLeaveConn)

            local clickConn = HoverFrame.MouseButton1Click:Connect(function()
                Box:CaptureFocus()
            end)
            AddToPool(clickConn)
        end

        function Elements:Dropdown(Text, Options, Callback)
            Options = Options or {}
            
            local Dropdown = Instance.new("Frame")
            Dropdown.Name = "Dropdown"
            Dropdown.Parent = Page
            Dropdown.BackgroundTransparency = 1
            Dropdown.BorderSizePixel = 0
            Dropdown.ClipsDescendants = false
            Dropdown.Size = UDim2.new(1, -6, 0, 34)

            local Choose = Instance.new("Frame")
            Choose.Name = "Choose"
            Choose.Parent = Dropdown
            Choose.BackgroundColor3 = Colors.ElementBackground
            Choose.BorderSizePixel = 0
            Choose.Size = UDim2.new(1, 0, 0, 34)

            local ChooseCorner = Instance.new("UICorner")
            ChooseCorner.CornerRadius = CORNER_RADIUS
            ChooseCorner.Parent = Choose

            local Title = Instance.new("TextLabel")
            Title.Name = "Title"
            Title.Parent = Choose
            Title.BackgroundTransparency = 1
            Title.Position = UDim2.new(0, 8, 0, 0)
            Title.Size = UDim2.new(1, -46, 1, 0)
            Title.Font = Enum.Font.Gotham
            Title.Text = Text or "Dropdown"
            Title.TextColor3 = Colors.TextPrimary
            Title.TextSize = 14
            Title.TextXAlignment = Enum.TextXAlignment.Left

            local Arrow = Instance.new("ImageButton")
            Arrow.Name = "Arrow"
            Arrow.Parent = Choose
            Arrow.AnchorPoint = Vector2.new(1, 0.5)
            Arrow.BackgroundTransparency = 1
            Arrow.Position = UDim2.new(1, -8, 0.5, 0)
            Arrow.Size = UDim2.new(0, 20, 0, 20)
            Arrow.Image = ASSETS.ARROW
            Arrow.ImageColor3 = Color3.fromRGB(12, 59, 161)
            Arrow.ImageRectOffset = ASSETS.ARROW_RECT_OFFSET
            Arrow.ImageRectSize = ASSETS.ARROW_RECT_SIZE
            Arrow.ScaleType = Enum.ScaleType.Fit

            local OptionHolder = Instance.new("Frame")
            OptionHolder.Name = "OptionHolder"
            OptionHolder.Parent = Page
            OptionHolder.BackgroundColor3 = Colors.ElementBackground
            OptionHolder.BorderSizePixel = 0
            OptionHolder.Position = UDim2.new(0, 0, 0, 0)
            OptionHolder.Size = UDim2.new(1, -6, 0, 0)
            OptionHolder.Visible = false
            OptionHolder.ZIndex = 100
            OptionHolder.ClipsDescendants = false

            local OptionHolderCorner = Instance.new("UICorner")
            OptionHolderCorner.CornerRadius = CORNER_RADIUS
            OptionHolderCorner.Parent = OptionHolder

            local OptionList = Instance.new("UIListLayout")
            OptionList.Name = "OptionList"
            OptionList.Parent = OptionHolder
            OptionList.HorizontalAlignment = Enum.HorizontalAlignment.Center
            OptionList.SortOrder = Enum.SortOrder.LayoutOrder
            OptionList.Padding = UDim.new(0, 5)

            local OptionPadding = Instance.new("UIPadding")
            OptionPadding.Parent = OptionHolder
            OptionPadding.PaddingTop = UDim.new(0, 8)
            OptionPadding.PaddingLeft = UDim.new(0, 8)
            OptionPadding.PaddingRight = UDim.new(0, 8)
            OptionPadding.PaddingBottom = UDim.new(0, 8)

            local Dropped = false

            local function RefreshOptions(NewOptions)
                NewOptions = NewOptions or {}
                for _, Child in ipairs(OptionHolder:GetChildren()) do
                    if Child:IsA("TextButton") then
                        Child:Destroy()
                    end
                end
                
                if #NewOptions == 0 then
                    local NoOption = Instance.new("TextButton")
                    NoOption.Name = "NoOption"
                    NoOption.Parent = OptionHolder
                    NoOption.BackgroundColor3 = Colors.MediumElement
                    NoOption.BorderSizePixel = 0
                    NoOption.Size = UDim2.new(1, -16, 0, 30)
                    NoOption.Font = Enum.Font.Gotham
                    NoOption.Text = "No Options Available"
                    NoOption.TextColor3 = Colors.TextPlaceholder
                    NoOption.TextSize = 14
                    NoOption.TextXAlignment = Enum.TextXAlignment.Center
                    NoOption.AutoButtonColor = false

                    local NoOptionCorner = Instance.new("UICorner")
                    NoOptionCorner.CornerRadius = CORNER_RADIUS
                    NoOptionCorner.Parent = NoOption
                else
                    for _, Option in ipairs(NewOptions) do
                        local OptionButton = Instance.new("TextButton")
                        OptionButton.Name = "Option"
                        OptionButton.Parent = OptionHolder
                        OptionButton.BackgroundColor3 = Colors.PrimaryDark
                        OptionButton.BorderSizePixel = 0
                        OptionButton.Size = UDim2.new(1, -16, 0, 30)
                        OptionButton.AutoButtonColor = false
                        OptionButton.Font = Enum.Font.Gotham
                        OptionButton.Text = Option
                        OptionButton.TextColor3 = Colors.TextPrimary
                        OptionButton.TextSize = 14
                        OptionButton.TextXAlignment = Enum.TextXAlignment.Center

                        local OptionCorner = Instance.new("UICorner")
                        OptionCorner.CornerRadius = CORNER_RADIUS
                        OptionCorner.Parent = OptionButton

                        local clickConn = OptionButton.MouseButton1Click:Connect(function()
                            if Callback then
                                task.spawn(Callback, Option)
                            end
                            Title.Text = (Text or "Dropdown") .. ": " .. Option
                            Dropped = false
                            OptionHolder.Visible = false
                            Arrow.Rotation = 0
                        end)
                        AddToPool(clickConn)

                        ApplyButtonHoverEffect(OptionButton, Colors.PrimaryDark, Colors.PrimaryHover)
                    end
                end
            end

            RefreshOptions(Options)

            local arrowClickConn = Arrow.MouseButton1Click:Connect(function()
                Dropped = not Dropped
                OptionHolder.Visible = Dropped
                Arrow.Rotation = Dropped and 180 or 0
                
                if Dropped then
                    task.spawn(function()
                        local ChooseAbsPos = Choose.AbsolutePosition
                        local ChooseAbsSize = Choose.AbsoluteSize
                        local PageAbsPos = Page.AbsolutePosition
                        local XPos = ChooseAbsPos.X - PageAbsPos.X
                        local YPos = (ChooseAbsPos.Y - PageAbsPos.Y) + ChooseAbsSize.Y + 5
                        OptionHolder.Position = UDim2.new(0, XPos, 0, YPos)
                    end)
                end
            end)
            AddToPool(arrowClickConn)

            local function CloseDropdown()
                if Dropped then
                    Dropped = false
                    OptionHolder.Visible = false
                    Arrow.Rotation = 0
                end
            end

            local function OnInputBegan(Input)
                if Dropped and Input.UserInputType == Enum.UserInputType.MouseButton1 then
                    local MousePos = Input.Position
                    local ChooseAbsPos = Choose.AbsolutePosition
                    local ChooseAbsSize = Choose.AbsoluteSize
                    local OptionHolderAbsPos = OptionHolder.AbsolutePosition
                    local OptionHolderAbsSize = OptionHolder.AbsoluteSize
                    
                    local InChoose = MousePos.X >= ChooseAbsPos.X and MousePos.X <= ChooseAbsPos.X + ChooseAbsSize.X and
                                   MousePos.Y >= ChooseAbsPos.Y and MousePos.Y <= ChooseAbsPos.Y + ChooseAbsSize.Y
                    local InOptions = MousePos.X >= OptionHolderAbsPos.X and MousePos.X <= OptionHolderAbsPos.X + OptionHolderAbsSize.X and
                                    MousePos.Y >= OptionHolderAbsPos.Y and MousePos.Y <= OptionHolderAbsPos.Y + OptionHolderAbsSize.Y
                    
                    if not (InChoose or InOptions) then
                        CloseDropdown()
                    end
                end
            end

            local inputBeganConn = UserInputService.InputBegan:Connect(OnInputBegan)
            AddToPool(inputBeganConn)

            local DropdownFunctions = {}
            function DropdownFunctions:Refresh(NewOptions)
                RefreshOptions(NewOptions)
                CloseDropdown()
            end
            return DropdownFunctions
        end

        if not FirstTabCreated then
            FirstTabCreated = true
            Page.Visible = true
            TabButton.BackgroundTransparency = 0.6
            TextLabel.TextColor3 = Colors.TextPrimary
        end

        return Elements
    end

    return TabFunctions
end

return Library