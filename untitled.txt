local TweenService = cloneref(game:GetService("TweenService"))
local UserInputService = cloneref(game:GetService("UserInputService"))
local CoreGui = cloneref(game:GetService("CoreGui"))

local COLORS = {
	MainBackground = Color3.fromRGB(30, 30, 30),
	TopBar = Color3.fromRGB(24, 24, 24),
	TabsBackground = Color3.fromRGB(33, 33, 33),
	ElementBackground = Color3.fromRGB(35, 35, 35),
	ElementHover = Color3.fromRGB(40, 40, 40),
	Primary = Color3.fromRGB(17, 85, 232),
	PrimaryDark = Color3.fromRGB(10, 49, 134),
	PrimaryHover = Color3.fromRGB(12, 59, 160),
	SecondaryButton = Color3.fromRGB(14, 69, 188),
	TextPrimary = Color3.fromRGB(255, 255, 255),
	TextSecondary = Color3.fromRGB(72, 72, 72),
	TextPlaceholder = Color3.fromRGB(150, 150, 150),
	DarkElement = Color3.fromRGB(43, 43, 43),
	MediumElement = Color3.fromRGB(52, 52, 52),
	MinimizeIcon = Color3.fromRGB(199, 199, 199),
}

-- Reusable tween info
local TWEEN_INFO = TweenInfo.new(0.2, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)
local TWEEN_INFO_FAST = TweenInfo.new(0.1, Enum.EasingStyle.Quad, Enum.EasingDirection.Out)

-- Utility functions
local function createInstance(className, props)
	local obj = Instance.new(className)
	for prop, value in pairs(props) do
		if prop ~= "Parent" then
			obj[prop] = value
		end
	end
	return obj
end

local function applyUICorner(parent, radius)
	local corner = createInstance("UICorner", {
		CornerRadius = UDim.new(0, radius or 6),
		Parent = parent
	})
	return corner
end

local function applyButtonHover(button, normalColor, hoverColor)
	button.MouseEnter:Connect(function()
		TweenService:Create(button, TWEEN_INFO, {BackgroundColor3 = hoverColor}):Play()
	end)
	
	button.MouseLeave:Connect(function()
		TweenService:Create(button, TWEEN_INFO, {BackgroundColor3 = normalColor}):Play()
	end)
end

local function roundToIncrement(value, increment)
	return increment == 0 and value or math.floor(value / increment + 0.5) * increment
end

local function formatNumber(value)
	local formatted = string.format("%.4f", value)
	formatted = formatted:gsub("0+$", "")
	formatted = formatted:gsub("%.$", "")
	return formatted
end

-- Dragging manager
local DraggingManager = {}
DraggingManager.__index = DraggingManager

function DraggingManager.new(frame)
	local self = setmetatable({}, DraggingManager)
	self.frame = frame
	self.dragging = false
	self.dragStart = Vector2.new(0, 0)
	self.startPos = UDim2.new()
	self.dragInput = nil
	
	self:init()
	return self
end

function DraggingManager:init()
	self.frame.InputBegan:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
			self.dragging = true
			self.dragStart = input.Position
			self.startPos = self.frame.Position
			
			local connection
			connection = input.Changed:Connect(function()
				if input.UserInputState == Enum.UserInputState.End then
					self.dragging = false
					connection:Disconnect()
				end
			end)
		end
	end)
	
	self.frame.InputChanged:Connect(function(input)
		if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
			self.dragInput = input
		end
	end)
	
	UserInputService.InputChanged:Connect(function(input)
		if input == self.dragInput and self.dragging then
			local delta = input.Position - self.dragStart
			local newPosition = UDim2.new(
				self.startPos.X.Scale,
				self.startPos.X.Offset + delta.X,
				self.startPos.Y.Scale,
				self.startPos.Y.Offset + delta.Y
			)
			self.frame.Position = newPosition
		end
	end)
end

-- Main Library
local Library = {}

function Library:Window(title)
	-- Clean up existing UI
	local existing = CoreGui:FindFirstChild("SentinelLIB")
	if existing then
		existing:Destroy()
	end
	
	-- Create main UI
	local ui = createInstance("ScreenGui", {
		Name = "SentinelLIB",
		ZIndexBehavior = Enum.ZIndexBehavior.Sibling,
		IgnoreGuiInset = true,
		ResetOnSpawn = false,
		Parent = CoreGui
	})
	
	local main = createInstance("Frame", {
		Name = "Main",
		Parent = ui,
		BackgroundColor3 = COLORS.MainBackground,
		BorderSizePixel = 0,
		Size = UDim2.new(0, 470, 0, 283),
		AnchorPoint = Vector2.new(0.5, 0.5),
		Position = UDim2.new(0.5, 0, 0.5, 0),
		Active = true,
		Selectable = true
	})
	
	-- Enable dragging
	DraggingManager.new(main)
	applyUICorner(main)
	
	-- Shadow effect
	createInstance("ImageLabel", {
		Name = "Shadow",
		Parent = main,
		AnchorPoint = Vector2.new(0.5, 0.5),
		BackgroundTransparency = 1,
		Position = UDim2.new(0.5, 0, 0.5, 0),
		Size = UDim2.new(1, 30, 1, 30),
		ZIndex = 0,
		Image = "rbxassetid://5554236805",
		ImageColor3 = Color3.fromRGB(0, 0, 0),
		ScaleType = Enum.ScaleType.Slice,
		SliceCenter = Rect.new(23, 23, 277, 277)
	})
	
	-- Top bar
	local top = createInstance("Frame", {
		Name = "Top",
		Parent = main,
		BackgroundColor3 = COLORS.TopBar,
		BorderSizePixel = 0,
		Size = UDim2.new(1, 0, 0, 34)
	})
	
	applyUICorner(top)
	
	createInstance("Frame", {
		Name = "Cover",
		Parent = top,
		AnchorPoint = Vector2.new(0.5, 1),
		BackgroundColor3 = COLORS.TopBar,
		BorderSizePixel = 0,
		Position = UDim2.new(0.5, 0, 1, 0),
		Size = UDim2.new(1, 0, 0, 4)
	})
	
	createInstance("Frame", {
		Name = "Line",
		Parent = top,
		AnchorPoint = Vector2.new(0.5, 1),
		BackgroundColor3 = Color3.fromRGB(255, 255, 255),
		BackgroundTransparency = 0.92,
		Position = UDim2.new(0.5, 0, 1, 1),
		Size = UDim2.new(1, 0, 0, 1)
	})
	
	-- Logo
	createInstance("ImageLabel", {
		Name = "Logo",
		Parent = top,
		AnchorPoint = Vector2.new(0, 0.5),
		BackgroundTransparency = 1,
		Position = UDim2.new(0, 4, 0.5, 0),
		Size = UDim2.new(0, 26, 0, 30),
		Image = "http://www.roblox.com/asset/?id=7803241868",
		ImageColor3 = COLORS.Primary
	})
	
	-- Minimize functionality
	local minimizeBtn = createInstance("ImageButton", {
		Name = "Minimize",
		Parent = top,
		AnchorPoint = Vector2.new(1, 0.5),
		BackgroundTransparency = 1,
		Position = UDim2.new(1, -6, 0.5, 0),
		Size = UDim2.new(0, 20, 0, 20),
		Image = "rbxassetid://121304296213645",
		ImageColor3 = COLORS.MinimizeIcon,
		ScaleType = Enum.ScaleType.Crop
	})
	
	local minimizedIcon = createInstance("ImageButton", {
		Name = "MinimizedIcon",
		Parent = ui,
		AnchorPoint = Vector2.new(1, 0),
		BackgroundColor3 = COLORS.Primary,
		BorderSizePixel = 0,
		Position = UDim2.new(1, -20, 0, 20),
		Size = UDim2.new(0, 40, 0, 40),
		Visible = false,
		ZIndex = 10,
		Image = "rbxassetid://7803241868"
	})
	
	applyUICorner(minimizedIcon, 8)
	DraggingManager.new(minimizedIcon)
	
	-- Minimize toggle
	minimizeBtn.MouseButton1Click:Connect(function()
		main.Visible = false
		minimizedIcon.Visible = true
	end)
	
	minimizeBtn.MouseEnter:Connect(function()
		TweenService:Create(minimizeBtn, TWEEN_INFO, {ImageColor3 = COLORS.TextPrimary}):Play()
	end)
	
	minimizeBtn.MouseLeave:Connect(function()
		TweenService:Create(minimizeBtn, TWEEN_INFO, {ImageColor3 = Color3.fromRGB(166, 166, 166)}):Play()
	end)
	
	minimizedIcon.MouseButton1Click:Connect(function()
		main.Visible = true
		minimizedIcon.Visible = false
	end)
	
	-- Title
	createInstance("TextLabel", {
		Name = "GameName",
		Parent = top,
		AnchorPoint = Vector2.new(0, 0.5),
		BackgroundTransparency = 1,
		Position = UDim2.new(0, 32, 0.5, 0),
		Size = UDim2.new(0, 165, 0, 22),
		Font = Enum.Font.Gotham,
		Text = title or "SentinelLIB",
		TextColor3 = COLORS.Primary,
		TextSize = 14,
		TextXAlignment = Enum.TextXAlignment.Left
	})
	
	-- Tabs section
	local tabs = createInstance("Frame", {
		Name = "Tabs",
		Parent = main,
		BackgroundColor3 = COLORS.TabsBackground,
		BorderSizePixel = 0,
		Position = UDim2.new(0, 0, 0, 35),
		Size = UDim2.new(0, 122, 1, -35)
	})
	
	applyUICorner(tabs)
	
	createInstance("Frame", {
		Name = "Cover",
		Parent = tabs,
		AnchorPoint = Vector2.new(1, 0.5),
		BackgroundColor3 = COLORS.TabsBackground,
		BorderSizePixel = 0,
		Position = UDim2.new(1, 0, 0.5, 0),
		Size = UDim2.new(0, 5, 1, 0)
	})
	
	local tabsContainer = createInstance("ScrollingFrame", {
		Name = "TabsContainer",
		Parent = tabs,
		BackgroundTransparency = 1,
		Size = UDim2.new(1, 0, 1, 0),
		CanvasSize = UDim2.new(0, 0, 0, 0),
		ScrollBarThickness = 0,
		ScrollBarImageTransparency = 1
	})
	
	local tabsList = createInstance("UIListLayout", {
		Name = "TabsList",
		Parent = tabsContainer,
		HorizontalAlignment = Enum.HorizontalAlignment.Center,
		SortOrder = Enum.SortOrder.LayoutOrder,
		Padding = UDim.new(0, 5)
	})
	
	createInstance("UIPadding", {
		Parent = tabsContainer,
		PaddingTop = UDim.new(0, 5)
	})
	
	tabsList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
		tabsContainer.CanvasSize = UDim2.new(0, 0, 0, tabsList.AbsoluteContentSize.Y + 10)
	end)
	
	-- Pages section
	local pages = createInstance("Frame", {
		Name = "Pages",
		Parent = main,
		BackgroundColor3 = COLORS.MainBackground,
		BorderSizePixel = 0,
		Position = UDim2.new(0, 130, 0, 42),
		Size = UDim2.new(1, -138, 1, -50)
	})
	
	applyUICorner(pages)
	
	local tabFunctions = {}
	local firstTabCreated = false
	
	function tabFunctions:Tab(tabTitle)
		local titleText = tabTitle or "Tab"
		
		-- Tab button
		local tabButton = createInstance("TextButton", {
			Name = "TabButton",
			Parent = tabsContainer,
			BackgroundColor3 = COLORS.Primary,
			BackgroundTransparency = 1,
			Size = UDim2.new(1, -12, 0, 30),
			AutoButtonColor = false,
			Font = Enum.Font.Gotham,
			Text = "",
			TextColor3 = COLORS.TextSecondary,
			TextSize = 14
		})
		
		applyUICorner(tabButton)
		
		local tabLabel = createInstance("TextLabel", {
			Name = "TextLabel",
			Parent = tabButton,
			BackgroundTransparency = 1,
			Size = UDim2.new(1, 0, 1, 0),
			Font = Enum.Font.Gotham,
			Text = titleText,
			TextColor3 = COLORS.TextSecondary,
			TextSize = 14,
			TextXAlignment = Enum.TextXAlignment.Center
		})
		
		-- Page
		local page = createInstance("ScrollingFrame", {
			Name = "Page",
			Parent = pages,
			Visible = false,
			Active = true,
			BackgroundTransparency = 1,
			BorderSizePixel = 0,
			Size = UDim2.new(1, 0, 1, 0),
			ScrollBarThickness = 0,
			ScrollBarImageTransparency = 1,
			ClipsDescendants = true
		})
		
		local pageList = createInstance("UIListLayout", {
			Parent = page,
			HorizontalAlignment = Enum.HorizontalAlignment.Center,
			SortOrder = Enum.SortOrder.LayoutOrder,
			Padding = UDim.new(0, 6)
		})
		
		createInstance("UIPadding", {
			Parent = page,
			PaddingTop = UDim.new(0, 5)
		})
		
		pageList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
			page.CanvasSize = UDim2.new(0, 0, 0, pageList.AbsoluteContentSize.Y + 13)
		end)
		
		-- Tab switching
		tabButton.MouseButton1Click:Connect(function()
			-- Hide all pages
			for _, child in pairs(pages:GetChildren()) do
				if child:IsA("ScrollingFrame") then
					child.Visible = false
				end
			end
			
			-- Show selected page
			page.Visible = true
			
			-- Reset all tabs
			for _, child in pairs(tabsContainer:GetChildren()) do
				if child.Name == "TabButton" then
					TweenService:Create(child, TWEEN_INFO, {BackgroundTransparency = 1}):Play()
					if child:FindFirstChild("TextLabel") then
						TweenService:Create(child.TextLabel, TWEEN_INFO, {TextColor3 = COLORS.TextSecondary}):Play()
					end
				end
			end
			
			-- Highlight selected tab
			TweenService:Create(tabButton, TWEEN_INFO, {BackgroundTransparency = 0.6}):Play()
			TweenService:Create(tabLabel, TWEEN_INFO, {TextColor3 = COLORS.TextPrimary}):Play()
		end)
		
		local elements = {}
		
		function elements:Button(text, callback)
			local button = createInstance("TextButton", {
				Name = "Button",
				Parent = page,
				BackgroundColor3 = COLORS.PrimaryDark,
				BorderSizePixel = 0,
				Size = UDim2.new(1, -6, 0, 34),
				AutoButtonColor = false,
				Font = Enum.Font.Gotham,
				Text = text or "Button",
				TextColor3 = COLORS.TextPrimary,
				TextSize = 14,
				TextXAlignment = Enum.TextXAlignment.Center
			})
			
			applyUICorner(button)
			applyButtonHover(button, COLORS.PrimaryDark, COLORS.PrimaryHover)
			
			button.MouseButton1Click:Connect(function()
				if callback then
					pcall(callback)
				end
			end)
			
			return button
		end
		
		function elements:Toggle(text, defaultValue, callback)
			local toggled = defaultValue or false
			
			local toggle = createInstance("TextButton", {
				Name = "Toggle",
				Parent = page,
				BackgroundColor3 = COLORS.ElementBackground,
				BorderSizePixel = 0,
				Size = UDim2.new(1, -6, 0, 34),
				AutoButtonColor = false,
				Text = ""
			})
			
			applyUICorner(toggle)
			
			createInstance("TextLabel", {
				Name = "Title",
				Parent = toggle,
				BackgroundTransparency = 1,
				Position = UDim2.new(0, 8, 0, 0),
				Size = UDim2.new(1, -6, 1, 0),
				Font = Enum.Font.Gotham,
				Text = text or "Toggle",
				TextColor3 = COLORS.TextPrimary,
				TextSize = 14,
				TextXAlignment = Enum.TextXAlignment.Left
			})
			
			local toggleFrame = createInstance("Frame", {
				Name = "ToggleFrame",
				Parent = toggle,
				AnchorPoint = Vector2.new(1, 0.5),
				BackgroundColor3 = Color3.fromRGB(12, 59, 161),
				BackgroundTransparency = toggled and 0 or 1,
				BorderSizePixel = 0,
				Position = UDim2.new(1, -8, 0.5, 0),
				Size = UDim2.new(0, 14, 0, 14)
			})
			
			applyUICorner(toggleFrame, 3)
			
			local check = createInstance("ImageLabel", {
				Name = "Check",
				Parent = toggleFrame,
				BackgroundTransparency = 1,
				Position = UDim2.new(-0.214285731, 0, -0.214285731, 0),
				Size = UDim2.new(0, 20, 0, 20),
				Image = "http://www.roblox.com/asset/?id=7812909048",
				ImageTransparency = toggled and 0 or 1,
				ScaleType = Enum.ScaleType.Fit
			})
			
			createInstance("UIStroke", {
				Parent = toggleFrame,
				LineJoinMode = Enum.LineJoinMode.Round,
				Thickness = 2,
				Color = Color3.fromRGB(12, 59, 161)
			})
			
			-- Hover effects
			applyButtonHover(toggle, COLORS.ElementBackground, COLORS.ElementHover)
			
			-- Toggle click
			toggle.MouseButton1Click:Connect(function()
				toggled = not toggled
				TweenService:Create(toggleFrame, TWEEN_INFO_FAST, {BackgroundTransparency = toggled and 0 or 1}):Play()
				TweenService:Create(check, TWEEN_INFO_FAST, {ImageTransparency = toggled and 0 or 1}):Play()
				
				if callback then
					pcall(callback, toggled)
				end
			end)
			
			local toggleFunctions = {}
			function toggleFunctions:Set(value)
				toggled = value
				TweenService:Create(toggleFrame, TWEEN_INFO_FAST, {BackgroundTransparency = toggled and 0 or 1}):Play()
				TweenService:Create(check, TWEEN_INFO_FAST, {ImageTransparency = toggled and 0 or 1}):Play()
				
				if callback then
					pcall(callback, toggled)
				end
			end
			
			return toggleFunctions
		end
		
		function elements:Label(text)
			local label = createInstance("TextLabel", {
				Parent = page,
				BackgroundColor3 = COLORS.ElementBackground,
				BorderSizePixel = 0,
				Size = UDim2.new(1, -6, 0, 34),
				Font = Enum.Font.Gotham,
				Text = text or "Label",
				TextColor3 = COLORS.TextPrimary,
				TextSize = 14,
				TextXAlignment = Enum.TextXAlignment.Center
			})
			
			applyUICorner(label)
			
			local labelFunctions = {}
			function labelFunctions:Set(newText)
				label.Text = newText or "Label"
			end
			
			return labelFunctions
		end
		
		function elements:Slider(text, min, max, defaultValue, increment, callback)
			min = min or 0
			max = max or 100
			defaultValue = defaultValue or min
			increment = increment or 1
			
			if min >= max then
				warn("Slider: Min must be less than Max. Using defaults.")
				min = 0
				max = 100
			end
			
			local slider = createInstance("Frame", {
				Name = "Slider",
				Parent = page,
				BackgroundColor3 = COLORS.ElementBackground,
				Size = UDim2.new(1, -6, 0, 48)
			})
			
			applyUICorner(slider)
			
			createInstance("TextLabel", {
				Name = "Title",
				Parent = slider,
				BackgroundTransparency = 1,
				Position = UDim2.new(0, 8, 0, 0),
				Size = UDim2.new(1, -6, 0, 34),
				Font = Enum.Font.Gotham,
				Text = text or "Slider",
				TextColor3 = COLORS.TextPrimary,
				TextSize = 14,
				TextXAlignment = Enum.TextXAlignment.Left
			})
			
			local valueLabel = createInstance("TextLabel", {
				Name = "Value",
				Parent = slider,
				AnchorPoint = Vector2.new(1, 0),
				BackgroundTransparency = 1,
				Position = UDim2.new(1, -10, 0, 0),
				Size = UDim2.new(1, 0, 0, 34),
				Font = Enum.Font.Gotham,
				Text = tostring(defaultValue),
				TextColor3 = COLORS.TextPrimary,
				TextSize = 14,
				TextXAlignment = Enum.TextXAlignment.Right
			})
			
			local sliderClick = createInstance("TextButton", {
				Name = "SliderClick",
				Parent = slider,
				AnchorPoint = Vector2.new(0.5, 1),
				BackgroundColor3 = COLORS.MediumElement,
				Position = UDim2.new(0.5, 0, 1, -8),
				Size = UDim2.new(1, -12, 0, 6),
				AutoButtonColor = false,
				Text = "",
				Selectable = false,
				Active = true
			})
			
			applyUICorner(sliderClick)
			
			local sliderDrag = createInstance("Frame", {
				Name = "SliderDrag",
				Parent = sliderClick,
				BackgroundColor3 = COLORS.SecondaryButton,
				Size = UDim2.new((defaultValue - min) / (max - min), 0, 1, 0)
			})
			
			applyUICorner(sliderDrag)
			
			local sliderDragging = false
			local currentInput = nil
			
			local function updateSlider(percent)
				local rawValue = min + (percent * (max - min))
				local sliderValue = roundToIncrement(rawValue, increment)
				local adjustedPercent = (sliderValue - min) / (max - min)
				
				sliderDrag.Size = UDim2.new(adjustedPercent, 0, 1, 0)
				valueLabel.Text = formatNumber(sliderValue)
				
				return sliderValue
			end
			
			local function handleInputBegan(input)
				if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
					sliderDragging = true
					currentInput = input
					
					local connection
					connection = input.Changed:Connect(function()
						if input.UserInputState == Enum.UserInputState.End then
							sliderDragging = false
							currentInput = nil
							
							local finalPercent = math.clamp(
								(input.Position.X - sliderClick.AbsolutePosition.X) / sliderClick.AbsoluteSize.X,
								0, 1
							)
							
							local finalValue = updateSlider(finalPercent)
							
							if callback then
								pcall(callback, finalValue)
							end
							
							connection:Disconnect()
						end
					end)
				end
			end
			
			sliderClick.InputBegan:Connect(handleInputBegan)
			
			UserInputService.InputChanged:Connect(function(input)
				if sliderDragging and input == currentInput and 
				   (input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch) then
					
					local percent = math.clamp(
						(input.Position.X - sliderClick.AbsolutePosition.X) / sliderClick.AbsoluteSize.X,
						0, 1
					)
					
					updateSlider(percent)
				end
			end)
		end
		
		function elements:InputBox(text, placeholder, callback)
			local inputBox = createInstance("Frame", {
				Name = "InputBox",
				Parent = page,
				BackgroundColor3 = COLORS.ElementBackground,
				BorderSizePixel = 0,
				Size = UDim2.new(1, -6, 0, 34)
			})
			
			applyUICorner(inputBox)
			
			createInstance("TextLabel", {
				Name = "Title",
				Parent = inputBox,
				BackgroundTransparency = 1,
				Position = UDim2.new(0, 8, 0, 0),
				Size = UDim2.new(0.4, -6, 1, 0),
				Font = Enum.Font.Gotham,
				Text = text or "Input",
				TextColor3 = COLORS.TextPrimary,
				TextSize = 14,
				TextXAlignment = Enum.TextXAlignment.Left
			})
			
			local boxContainer = createInstance("Frame", {
				Name = "BoxContainer",
				Parent = inputBox,
				BackgroundTransparency = 1,
				AnchorPoint = Vector2.new(1, 0.5),
				Position = UDim2.new(1, -6, 0.5, 0),
				Size = UDim2.new(0.55, -12, 0, 24),
				ClipsDescendants = true
			})
			
			local box = createInstance("TextBox", {
				Name = "Box",
				Parent = boxContainer,
				BackgroundColor3 = COLORS.DarkElement,
				BorderSizePixel = 0,
				Size = UDim2.new(1, 0, 1, 0),
				Font = Enum.Font.Gotham,
				PlaceholderText = placeholder or "Enter text...",
				PlaceholderColor3 = COLORS.TextPlaceholder,
				Text = "",
				TextColor3 = COLORS.TextPrimary,
				TextSize = 14,
				TextXAlignment = Enum.TextXAlignment.Center
			})
			
			applyUICorner(box, 4)
			
			box.FocusLost:Connect(function(enterPressed)
				if callback and (enterPressed or not box:IsFocused()) then
					pcall(callback, box.Text)
				end
			end)
			
			-- Hover frame
			local hoverFrame = createInstance("TextButton", {
				Name = "HoverFrame",
				Parent = inputBox,
				BackgroundColor3 = COLORS.ElementBackground,
				BorderSizePixel = 0,
				Size = UDim2.new(1, 0, 1, 0),
				AutoButtonColor = false,
				Text = "",
				ZIndex = 0
			})
			
			applyButtonHover(inputBox, COLORS.ElementBackground, COLORS.ElementHover)
			
			hoverFrame.MouseButton1Click:Connect(function()
				box:CaptureFocus()
			end)
		end
		
		function elements:Dropdown(text, options, callback)
			options = options or {}
			
			local dropdown = createInstance("Frame", {
				Name = "Dropdown",
				Parent = page,
				BackgroundTransparency = 1,
				BorderSizePixel = 0,
				ClipsDescendants = false,
				Size = UDim2.new(1, -6, 0, 34)
			})
			
			local choose = createInstance("Frame", {
				Name = "Choose",
				Parent = dropdown,
				BackgroundColor3 = COLORS.ElementBackground,
				BorderSizePixel = 0,
				Size = UDim2.new(1, 0, 0, 34)
			})
			
			applyUICorner(choose)
			
			local title = createInstance("TextLabel", {
				Name = "Title",
				Parent = choose,
				BackgroundTransparency = 1,
				Position = UDim2.new(0, 8, 0, 0),
				Size = UDim2.new(1, -46, 1, 0),
				Font = Enum.Font.Gotham,
				Text = text or "Dropdown",
				TextColor3 = COLORS.TextPrimary,
				TextSize = 14,
				TextXAlignment = Enum.TextXAlignment.Left
			})
			
			local arrow = createInstance("ImageButton", {
				Name = "Arrow",
				Parent = choose,
				AnchorPoint = Vector2.new(1, 0.5),
				BackgroundTransparency = 1,
				Position = UDim2.new(1, -8, 0.5, 0),
				Size = UDim2.new(0, 20, 0, 20),
				Image = "rbxassetid://3926307971",
				ImageColor3 = Color3.fromRGB(12, 59, 161),
				ImageRectOffset = Vector2.new(324, 524),
				ImageRectSize = Vector2.new(36, 36),
				ScaleType = Enum.ScaleType.Fit
			})
			
			local optionHolder = createInstance("Frame", {
				Name = "OptionHolder",
				Parent = page,
				BackgroundColor3 = COLORS.ElementBackground,
				BorderSizePixel = 0,
				Position = UDim2.new(0, 0, 0, 0),
				Size = UDim2.new(1, -6, 0, 0),
				Visible = false,
				ZIndex = 100,
				ClipsDescendants = false
			})
			
			applyUICorner(optionHolder)
			
			local optionList = createInstance("UIListLayout", {
				Name = "OptionList",
				Parent = optionHolder,
				HorizontalAlignment = Enum.HorizontalAlignment.Center,
				SortOrder = Enum.SortOrder.LayoutOrder,
				Padding = UDim.new(0, 5)
			})
			
			createInstance("UIPadding", {
				Parent = optionHolder,
				PaddingTop = UDim.new(0, 8),
				PaddingLeft = UDim.new(0, 8),
				PaddingRight = UDim.new(0, 8),
				PaddingBottom = UDim.new(0, 8)
			})
			
			optionList:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
				local contentHeight = optionList.AbsoluteContentSize.Y + 16
				optionHolder.Size = UDim2.new(1, -6, 0, contentHeight)
			end)
			
			local dropped = false
			local inputConnection = nil
			
			local function refreshOptions(newOptions)
				newOptions = newOptions or {}
				
				-- Clear existing options
				for _, child in ipairs(optionHolder:GetChildren()) do
					if child:IsA("TextButton") then
						child:Destroy()
					end
				end
				
				title.Text = text or "Dropdown"
				
				if #newOptions == 0 then
					local noOption = createInstance("TextButton", {
						Name = "NoOption",
						Parent = optionHolder,
						BackgroundColor3 = COLORS.MediumElement,
						BorderSizePixel = 0,
						Size = UDim2.new(1, -16, 0, 30),
						Font = Enum.Font.Gotham,
						Text = "No Options Available",
						TextColor3 = COLORS.TextPlaceholder,
						TextSize = 14,
						TextXAlignment = Enum.TextXAlignment.Center,
						AutoButtonColor = false,
						Selectable = false,
						Active = false
					})
					
					applyUICorner(noOption)
				else
					for _, option in ipairs(newOptions) do
						local optionButton = createInstance("TextButton", {
							Name = "Option",
							Parent = optionHolder,
							BackgroundColor3 = COLORS.PrimaryDark,
							BorderSizePixel = 0,
							Size = UDim2.new(1, -16, 0, 30),
							AutoButtonColor = false,
							Font = Enum.Font.Gotham,
							Text = option,
							TextColor3 = COLORS.TextPrimary,
							TextSize = 14,
							TextXAlignment = Enum.TextXAlignment.Center
						})
						
						applyUICorner(optionButton)
						applyButtonHover(optionButton, COLORS.PrimaryDark, COLORS.PrimaryHover)
						
						optionButton.MouseButton1Click:Connect(function()
							if callback then
								pcall(callback, option)
							end
							
							title.Text = (text or "Dropdown") .. ": " .. option
							dropped = false
							optionHolder.Visible = false
							arrow.Rotation = 0
						end)
					end
				end
			end
			
			refreshOptions(options)
			
			arrow.MouseButton1Click:Connect(function()
				dropped = not dropped
				
				if dropped then
					optionHolder.Visible = true
					arrow.Rotation = 180
					
					task.wait(0.01)
					
					local chooseAbsPos = choose.AbsolutePosition
					local chooseAbsSize = choose.AbsoluteSize
					local pageAbsPos = page.AbsolutePosition
					
					local xPos = chooseAbsPos.X - pageAbsPos.X
					local yPos = (chooseAbsPos.Y - pageAbsPos.Y) + chooseAbsSize.Y + 5
					
					optionHolder.Position = UDim2.new(0, xPos, 0, yPos)
				else
					optionHolder.Visible = false
					arrow.Rotation = 0
				end
			end)
			
			local function closeDropdown()
				if dropped then
					dropped = false
					optionHolder.Visible = false
					arrow.Rotation = 0
				end
			end
			
			local function onInputBegan(input)
				if dropped and input.UserInputType == Enum.UserInputType.MouseButton1 then
					local mousePos = input.Position
					local optionHolderAbsPos = optionHolder.AbsolutePosition
					local optionHolderAbsSize = optionHolder.AbsoluteSize
					local chooseAbsPos = choose.AbsolutePosition
					local chooseAbsSize = choose.AbsoluteSize
					
					local isClickInsideChoose = 
						mousePos.X >= chooseAbsPos.X and mousePos.X <= chooseAbsPos.X + chooseAbsSize.X and
						mousePos.Y >= chooseAbsPos.Y and mousePos.Y <= chooseAbsPos.Y + chooseAbsSize.Y
					
					local isClickInsideOptions = 
						mousePos.X >= optionHolderAbsPos.X and mousePos.X <= optionHolderAbsPos.X + optionHolderAbsSize.X and
						mousePos.Y >= optionHolderAbsPos.Y and mousePos.Y <= optionHolderAbsPos.Y + optionHolderAbsSize.Y
					
					if not (isClickInsideChoose or isClickInsideOptions) then
						closeDropdown()
					end
				end
			end
			
			inputConnection = UserInputService.InputBegan:Connect(onInputBegan)
			
			dropdown.Destroying:Connect(function()
				if inputConnection then
					inputConnection:Disconnect()
					inputConnection = nil
				end
			end)
			
			local dropdownFunctions = {}
			
			function dropdownFunctions:Refresh(newOptions)
				refreshOptions(newOptions)
				closeDropdown()
			end
			
			return dropdownFunctions
		end
		
		-- Activate first tab
		if not firstTabCreated then
			firstTabCreated = true
			page.Visible = true
			
			TweenService:Create(tabButton, TWEEN_INFO, {BackgroundTransparency = 0.6}):Play()
			TweenService:Create(tabLabel, TWEEN_INFO, {TextColor3 = COLORS.TextPrimary}):Play()
		end
		
		return elements
	end
	
	return tabFunctions
end

return Library