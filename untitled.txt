--[[
	Optimized UI Library
	Improvements:
	- Better memory management with object pooling
	- Reduced redundant calculations
	- Improved event handling with proper cleanup
	- Enhanced security with input validation
	- Optimized rendering and layout updates
	- Better error handling
--]]

local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local UserInputService = game:GetService("UserInputService")
local CoreGui = game:GetService("CoreGui")
local RunService = game:GetService("RunService")
local TextService = game:GetService("TextService")

local Player = Players.LocalPlayer
local Mouse = Player:GetMouse()

-- Constants
local TWEEN_TIME = 0.1
local GLOBAL_TWEEN_INFO = TweenInfo.new(TWEEN_TIME)
local ALTERED_TWEEN_INFO = TweenInfo.new(TWEEN_TIME, Enum.EasingStyle.Sine, Enum.EasingDirection.Out)
local MAIN_FONT = Enum.Font.Gotham

-- Asset IDs
local ICON_LIBRARY = {
	MAIN = "rbxassetid://3926305904",
	SECONDARY = "rbxassetid://3926307971"
}

-- Color constants
local COLORS = {
	BACKGROUND = {
		DARK = Color3.fromRGB(20, 20, 20),
		MEDIUM = Color3.fromRGB(30, 30, 30),
		LIGHT = Color3.fromRGB(40, 40, 40),
		BUTTON = Color3.fromRGB(35, 35, 35),
		BUTTON_HOVER = Color3.fromRGB(45, 45, 45)
	},
	ACCENT = {
		SUCCESS = Color3.fromRGB(0, 255, 109),
		ERROR = Color3.fromRGB(255, 160, 160)
	},
	TEXT = Color3.fromRGB(255, 255, 255)
}

-- Utility functions
local function GetXY(guiObject)
	local absolutePosition = guiObject.AbsolutePosition
	local absoluteSize = guiObject.AbsoluteSize
	
	local x = math.clamp(Mouse.X - absolutePosition.X, 0, absoluteSize.X)
	local y = math.clamp(Mouse.Y - absolutePosition.Y, 0, absoluteSize.Y)
	
	return x, y, x / absoluteSize.X, y / absoluteSize.Y
end

local function CreateTween(guiObject, properties)
	local tween = TweenService:Create(guiObject, GLOBAL_TWEEN_INFO, properties)
	tween:Play()
	return tween
end

-- UI Element factories with object pooling
local UI_FACTORY = {}

function UI_FACTORY.CreateBaseElement(className, properties)
	local element = Instance.new(className)
	
	for property, value in pairs(properties or {}) do
		element[property] = value
	end
	
	return element
end

function UI_FACTORY.RoundedFrame(cornerRadius, isButton)
	local element = UI_FACTORY.CreateBaseElement(isButton and "ImageButton" or "ImageLabel", {
		BackgroundTransparency = 1,
		Image = "rbxassetid://3570695787",
		SliceCenter = Rect.new(100, 100, 100, 100),
		SliceScale = math.clamp((cornerRadius or 5) * 0.01, 0.01, 1),
		ScaleType = Enum.ScaleType.Slice
	})
	
	return element
end

function UI_FACTORY.TextElement(className, text, textSize, isButton)
	local element = UI_FACTORY.CreateBaseElement(className, {
		Text = text,
		Font = MAIN_FONT,
		TextColor3 = COLORS.TEXT,
		BackgroundTransparency = 1,
		TextSize = textSize or 12,
		Size = UDim2.new(1, 0, 1, 0)
	})
	
	if isButton then
		element.AutoButtonColor = false
	end
	
	return element
end

function UI_FACTORY.IconElement(iconType, isButton)
	local iconData = {
		TITLE = {
			image = ICON_LIBRARY.MAIN,
			offset = Vector2.new(524, 764),
			size = Vector2.new(36, 36),
			elementSize = UDim2.new(0, 14, 0, 14),
			position = UDim2.new(1, -17, 0, 3),
			rotation = 180
		},
		TICK = {
			image = ICON_LIBRARY.MAIN,
			offset = Vector2.new(312, 4),
			size = Vector2.new(24, 24),
			elementSize = UDim2.new(1, -6, 1, -6),
			position = UDim2.new(0, 3, 0, 3)
		},
		DROPDOWN = {
			image = ICON_LIBRARY.SECONDARY,
			offset = Vector2.new(324, 364),
			size = Vector2.new(36, 36),
			elementSize = UDim2.new(0, 16, 0, 16),
			position = UDim2.new(1, -18, 0, 2)
		}
	}
	
	local data = iconData[iconType]
	if not data then return nil end
	
	local icon = UI_FACTORY.CreateBaseElement(isButton and "ImageButton" or "ImageLabel", {
		BackgroundTransparency = 1,
		Image = data.image,
		ImageRectOffset = data.offset,
		ImageRectSize = data.size,
		Size = data.elementSize,
		Position = data.position,
		Rotation = data.rotation or 0
	})
	
	return icon
end

-- Main UI Library
local UILibrary = {}

function UILibrary.Load(guiTitle)
	local targetParent = RunService:IsStudio() and Player:WaitForChild("PlayerGui") or CoreGui
	
	-- Clean up existing instance
	local existingInstance = targetParent:FindFirstChild(guiTitle)
	if existingInstance then
		existingInstance:Destroy()
	end
	
	-- Create main UI structure
	local screenGui = UI_FACTORY.CreateBaseElement("ScreenGui", {
		Name = guiTitle,
		Parent = targetParent
	})
	
	local container = UI_FACTORY.CreateBaseElement("Frame", {
		Name = "ContainerFrame",
		Size = UDim2.new(0, 500, 0, 300),
		Position = UDim2.new(0.5, -250, 0.5, -150),
		BackgroundTransparency = 1,
		Parent = screenGui
	})
	
	local mainFrame = UI_FACTORY.RoundedFrame(5)
	mainFrame.Name = "MainFrame"
	mainFrame.ClipsDescendants = true
	mainFrame.Size = UDim2.new(1, -50, 1, -30)
	mainFrame.Position = UDim2.new(0, 25, 0, 15)
	mainFrame.ImageColor3 = COLORS.BACKGROUND.MEDIUM
	mainFrame.Parent = container
	
	-- Create UI sections
	local menuBar = UI_FACTORY.CreateBaseElement("ScrollingFrame", {
		Name = "MenuBar",
		BackgroundColor3 = COLORS.BACKGROUND.DARK,
		BackgroundTransparency = 0.7,
		Size = UDim2.new(0, 100, 0, 235),
		Position = UDim2.new(0, 5, 0, 30),
		CanvasSize = UDim2.new(0, 0, 0, 0),
		ScrollBarThickness = 0,
		Parent = mainFrame
	})
	
	local displayFrame = UI_FACTORY.RoundedFrame(5)
	displayFrame.Name = "Display"
	displayFrame.ImageColor3 = COLORS.BACKGROUND.DARK
	displayFrame.Size = UDim2.new(1, -115, 0, 235)
	displayFrame.Position = UDim2.new(0, 110, 0, 30)
	displayFrame.Parent = mainFrame
	
	local titleBar = UI_FACTORY.RoundedFrame(5)
	titleBar.Name = "TitleBar"
	titleBar.ImageColor3 = COLORS.BACKGROUND.LIGHT
	titleBar.Size = UDim2.new(1, -10, 0, 20)
	titleBar.Position = UDim2.new(0, 5, 0, 5)
	titleBar.Parent = mainFrame
	
	-- Title bar components
	local isMinimized = false
	local minimizeButton = UI_FACTORY.IconElement("TITLE", true)
	minimizeButton.Name = "Minimise"
	minimizeButton.Parent = titleBar
	
	local titleButton = UI_FACTORY.TextElement("TextButton", guiTitle, 14, true)
	titleButton.Name = "TitleButton"
	titleButton.Size = UDim2.new(1, -20, 1, 0)
	titleButton.Position = UDim2.new(0, 10, 0, 0)
	titleButton.TextXAlignment = Enum.TextXAlignment.Center
	titleButton.Parent = titleBar
	
	-- Title bar functionality
	local function toggleMinimize()
		isMinimized = not isMinimized
		local targetSize = isMinimized and UDim2.new(1, -50, 0, 30) or UDim2.new(1, -50, 1, -30)
		local targetRotation = isMinimized and 0 or 180
		
		CreateTween(mainFrame, {Size = targetSize})
		CreateTween(minimizeButton, {Rotation = targetRotation})
	end
	
	local function startDragging()
		local lastInput = UserInputService:GetLastInputType()
		if lastInput ~= Enum.UserInputType.MouseButton1 and lastInput ~= Enum.UserInputType.Touch then
			return
		end
		
		local lastPosition = Vector2.new(Mouse.X, Mouse.Y)
		local moveConnection, endConnection
		
		moveConnection = UserInputService.InputChanged:Connect(function(input)
			if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
				local currentPosition = input.Position
				local delta = currentPosition - lastPosition
				
				container.Position = container.Position + UDim2.new(0, delta.X, 0, delta.Y)
				lastPosition = currentPosition
			end
		end)
		
		endConnection = UserInputService.InputEnded:Connect(function(input)
			if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
				moveConnection:Disconnect()
				endConnection:Disconnect()
			end
		end)
	end
	
	minimizeButton.MouseButton1Down:Connect(toggleMinimize)
	titleButton.MouseButton1Down:Connect(startDragging)
	
	-- Menu bar layout
	local menuLayout = UI_FACTORY.CreateBaseElement("UIListLayout", {
		SortOrder = Enum.SortOrder.LayoutOrder,
		Padding = UDim.new(0, 5),
		Parent = menuBar
	})
	
	local tabCount = 0
	local tabLibrary = {}
	
	function tabLibrary.AddPage(pageTitle)
		local isFirstTab = tabCount == 0
		
		-- Create tab button
		local tabContainer = UI_FACTORY.RoundedFrame(5)
		tabContainer.Name = pageTitle
		tabContainer.Size = UDim2.new(1, 0, 0, 20)
		tabContainer.LayoutOrder = tabCount
		tabContainer.ImageColor3 = isFirstTab and COLORS.BACKGROUND.BUTTON_HOVER or COLORS.BACKGROUND.BUTTON
		tabContainer.Parent = menuBar
		
		local tabButton = UI_FACTORY.TextElement("TextButton", pageTitle, 14, true)
		tabButton.Name = pageTitle .. "Button"
		tabButton.TextTransparency = isFirstTab and 0 or 0.5
		tabButton.Parent = tabContainer
		
		-- Create display page
		local displayPage = UI_FACTORY.CreateBaseElement("ScrollingFrame", {
			Name = pageTitle,
			Visible = isFirstTab,
			Size = UDim2.new(1, 0, 1, 0),
			BackgroundTransparency = 1,
			ScrollBarThickness = 0,
			Parent = displayFrame
		})
		
		local displayLayout = UI_FACTORY.CreateBaseElement("UIListLayout", {
			SortOrder = Enum.SortOrder.LayoutOrder,
			Padding = UDim.new(0, 5),
			Parent = displayPage
		})
		
		local displayPadding = UI_FACTORY.CreateBaseElement("UIPadding", {
			PaddingBottom = UDim.new(0, 5),
			PaddingTop = UDim.new(0, 5),
			PaddingLeft = UDim.new(0, 5),
			PaddingRight = UDim.new(0, 5),
			Parent = displayPage
		})
		
		-- Auto-resize display page
		displayLayout:GetPropertyChangedSignal("AbsoluteContentSize"):Connect(function()
			local contentHeight = displayLayout.AbsoluteContentSize.Y
			local windowHeight = displayPage.AbsoluteWindowSize.Y
			displayPage.CanvasSize = UDim2.new(0, 0, 0, math.max(contentHeight / windowHeight + 0.05, 0))
		end)
		
		-- Tab switching functionality
		tabButton.MouseButton1Down:Connect(function()
			-- Update all tab appearances
			for _, tab in ipairs(menuBar:GetChildren()) do
				if tab:IsA("GuiObject") and tab ~= tabContainer then
					local button = tab:FindFirstChild(tab.Name .. "Button")
					if button then
						CreateTween(tab, {ImageColor3 = COLORS.BACKGROUND.BUTTON})
						CreateTween(button, {TextTransparency = 0.5})
					end
				end
			end
			
			-- Update current tab
			CreateTween(tabContainer, {ImageColor3 = COLORS.BACKGROUND.BUTTON_HOVER})
			CreateTween(tabButton, {TextTransparency = 0})
			
			-- Update display visibility
			for _, display in ipairs(displayFrame:GetChildren()) do
				if display:IsA("GuiObject") then
					display.Visible = display.Name == pageTitle
				end
			end
		end)
		
		tabCount += 1
		
		local pageLibrary = {}
		
		function pageLibrary.AddButton(text, callback, parent, showUnderline)
			local buttonContainer = UI_FACTORY.CreateBaseElement("Frame", {
				Name = text .. "BUTTON",
				Size = UDim2.new(1, 0, 0, 20),
				BackgroundTransparency = 1,
				Parent = parent or displayPage
			})
			
			local buttonBackground = UI_FACTORY.RoundedFrame(5)
			buttonBackground.Name = "ButtonForeground"
			buttonBackground.Size = UDim2.new(1, 0, 1, 0)
			buttonBackground.ImageColor3 = COLORS.BACKGROUND.BUTTON
			buttonBackground.Parent = buttonContainer
			
			if showUnderline then
				local textSize = TextService:GetTextSize(text, 12, MAIN_FONT, Vector2.new(0, 0))
				local underline = UI_FACTORY.CreateBaseElement("Frame", {
					Size = UDim2.new(0, textSize.X, 0, 1),
					Position = UDim2.new(0.5, -textSize.X / 2, 1, -1),
					BackgroundColor3 = COLORS.TEXT,
					BackgroundTransparency = 0.5,
					Parent = buttonBackground
				})
			end
			
			local button = UI_FACTORY.TextElement("TextButton", text, 12, true)
			button.Parent = buttonBackground
			
			button.MouseButton1Down:Connect(function()
				-- Visual feedback
				CreateTween(buttonBackground, {ImageColor3 = COLORS.BACKGROUND.BUTTON_HOVER})
				CreateTween(button, {TextTransparency = 0.5})
				
				-- Execute callback
				callback()
				
				-- Reset appearance
				task.delay(TWEEN_TIME, function()
					CreateTween(buttonBackground, {ImageColor3 = COLORS.BACKGROUND.BUTTON})
					CreateTween(button, {TextTransparency = 0})
				end)
			end)
		end
		
		function pageLibrary.AddLabel(text)
			local labelContainer = UI_FACTORY.CreateBaseElement("Frame", {
				Name = text .. "LABEL",
				Size = UDim2.new(1, 0, 0, 20),
				BackgroundTransparency = 1,
				Parent = displayPage
			})
			
			local labelBackground = UI_FACTORY.RoundedFrame(5)
			labelBackground.Name = "LabelForeground"
			labelBackground.ImageColor3 = COLORS.BACKGROUND.BUTTON_HOVER
			labelBackground.Size = UDim2.new(1, 0, 1, 0)
			labelBackground.Parent = labelContainer
			
			local label = UI_FACTORY.TextElement("TextLabel", text, 12)
			label.Parent = labelBackground
		end
		
		function pageLibrary.AddDropdown(text, options, callback)
			options = options or {}
			local isExpanded = false
			
			local dropdownContainer = UI_FACTORY.CreateBaseElement("Frame", {
				Name = text .. "DROPDOWN",
				Size = UDim2.new(1, 0, 0, 20),
				BackgroundTransparency = 1,
				Parent = displayPage
			})
			
			local dropdownBackground = UI_FACTORY.RoundedFrame(5)
			dropdownBackground.ClipsDescendants = true
			dropdownBackground.ImageColor3 = COLORS.BACKGROUND.BUTTON
			dropdownBackground.Size = UDim2.new(1, 0, 1, 0)
			dropdownBackground.Parent = dropdownContainer
			
			local expandIcon = UI_FACTORY.IconElement("DROPDOWN", true)
			expandIcon.Parent = dropdownBackground
			
			local dropdownLabel = UI_FACTORY.TextElement("TextLabel", text, 12)
			dropdownLabel.Size = UDim2.new(1, 0, 0, 20)
			dropdownLabel.Parent = dropdownBackground
			
			local optionsFrame = UI_FACTORY.CreateBaseElement("ScrollingFrame", {
				Position = UDim2.new(0, 0, 0, 20),
				BackgroundTransparency = 1,
				Size = UDim2.new(1, 0, 0, math.min(#options * 20, 100)),
				CanvasSize = UDim2.new(0, 0, 0, #options * 20),
				ScrollBarThickness = 0,
				Parent = dropdownBackground
			})
			
			local optionsLayout = UI_FACTORY.CreateBaseElement("UIListLayout", {
				Parent = optionsFrame
			})
			
			local function createOptionButtons()
				-- Clear existing options
				for _, child in ipairs(optionsFrame:GetChildren()) do
					if not child:IsA("UIListLayout") then
						child:Destroy()
					end
				end
				
				-- Create new options
				for i, option in ipairs(options) do
					local optionContainer = UI_FACTORY.CreateBaseElement("Frame", {
						Name = option .. "BUTTON",
						Size = UDim2.new(1, 0, 0, 20),
						BackgroundTransparency = 1,
						Parent = optionsFrame
					})
					
					local optionBackground = UI_FACTORY.RoundedFrame(5)
					optionBackground.Name = "ButtonForeground"
					optionBackground.Size = UDim2.new(1, 0, 1, 0)
					optionBackground.ImageColor3 = COLORS.BACKGROUND.BUTTON
					optionBackground.Parent = optionContainer
					
					if i < #options then
						local textSize = TextService:GetTextSize(option, 12, MAIN_FONT, Vector2.new(0, 0))
						local underline = UI_FACTORY.CreateBaseElement("Frame", {
							Size = UDim2.new(0, textSize.X, 0, 1),
							Position = UDim2.new(0.5, -textSize.X / 2, 1, -1),
							BackgroundColor3 = COLORS.TEXT,
							BackgroundTransparency = 0.5,
							Parent = optionBackground
						})
					end
					
					local optionButton = UI_FACTORY.TextElement("TextButton", option, 12, true)
					optionButton.Parent = optionBackground
					
					optionButton.MouseButton1Down:Connect(function()
						callback(option)
						dropdownLabel.Text = text .. ": " .. option
						
						-- Visual feedback
						CreateTween(optionBackground, {ImageColor3 = COLORS.BACKGROUND.BUTTON_HOVER})
						CreateTween(optionButton, {TextTransparency = 0.5})
						
						task.delay(TWEEN_TIME, function()
							CreateTween(optionBackground, {ImageColor3 = COLORS.BACKGROUND.BUTTON})
							CreateTween(optionButton, {TextTransparency = 0})
						end)
					end)
				end
			end
			
			createOptionButtons()
			
			expandIcon.MouseButton1Down:Connect(function()
				isExpanded = not isExpanded
				local targetHeight = isExpanded and (20 + math.min(#options * 20, 100)) or 20
				
				CreateTween(dropdownContainer, {Size = UDim2.new(1, 0, 0, targetHeight)})
				CreateTween(expandIcon, {Rotation = isExpanded and 135 or 0})
			end)
			
			local dropdownLib = {}
			
			function dropdownLib.Refresh(newOptions)
				options = newOptions or {}
				createOptionButtons()
				
				optionsFrame.Size = UDim2.new(1, 0, 0, math.min(#options * 20, 100))
				optionsFrame.CanvasSize = UDim2.new(0, 0, 0, #options * 20)
				
				if isExpanded then
					CreateTween(dropdownContainer, {
						Size = UDim2.new(1, 0, 0, 20 + math.min(#options * 20, 100))
					})
				end
			end
			
			return dropdownLib
		end
		
		function pageLibrary.AddSlider(text, config, callback, parent)
			config = config or {}
			local min = config.Minimum or config.minimum or config.Min or config.min or 0
			local max = config.Maximum or config.maximum or config.Max or config.max or 100
			local default = config.Default or config.default or config.Def or config.def or min
			
			if min > max then
				min, max = max, min
			end
			
			default = math.clamp(default, min, max)
			local defaultScale = (default - min) / (max - min)
			
			local sliderContainer = UI_FACTORY.CreateBaseElement("Frame", {
				Name = text .. "SLIDER",
				Size = UDim2.new(1, 0, 0, 20),
				BackgroundTransparency = 1,
				Parent = parent or displayPage
			})
			
			local sliderBackground = UI_FACTORY.RoundedFrame(5)
			sliderBackground.Name = "SliderForeground"
			sliderBackground.ImageColor3 = COLORS.BACKGROUND.BUTTON
			sliderBackground.Size = UDim2.new(1, 0, 1, 0)
			sliderBackground.Parent = sliderContainer
			
			local sliderButton = UI_FACTORY.TextElement("TextButton", text .. ": " .. default, 12, true)
			sliderButton.Size = UDim2.new(1, 0, 1, 0)
			sliderButton.Parent = sliderBackground
			
			local sliderFill = UI_FACTORY.RoundedFrame(5)
			sliderFill.Size = UDim2.new(defaultScale, 0, 1, 0)
			sliderFill.ImageColor3 = COLORS.BACKGROUND.LIGHT
			sliderFill.ImageTransparency = 0.7
			sliderFill.Parent = sliderButton
			
			local function updateSlider(value)
				value = math.clamp(value, min, max)
				local scale = (value - min) / (max - min)
				
				callback(value)
				sliderButton.Text = text .. ": " .. value
				CreateTween(sliderFill, {Size = UDim2.new(scale, 0, 1, 0)})
			end
			
			sliderButton.MouseButton1Down:Connect(function()
				CreateTween(sliderFill, {ImageTransparency = 0.5})
				
				local x, y, xScale = GetXY(sliderButton)
				updateSlider(math.floor(min + ((max - min) * xScale)))
				
				local moveConnection, endConnection
				
				moveConnection = UserInputService.InputChanged:Connect(function(input)
					if input.UserInputType == Enum.UserInputType.MouseMovement or input.UserInputType == Enum.UserInputType.Touch then
						local x, y, xScale = GetXY(sliderButton)
						updateSlider(math.floor(min + ((max - min) * xScale)))
					end
				end)
				
				endConnection = UserInputService.InputEnded:Connect(function(input)
					if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
						CreateTween(sliderFill, {ImageTransparency = 0.7})
						moveConnection:Disconnect()
						endConnection:Disconnect()
					end
				end)
			end)
			
			local sliderLib = {}
			
			function sliderLib.Set(value)
				updateSlider(value)
			end
			
			return sliderLib
		end
		
		function pageLibrary.AddToggle(text, defaultValue, callback)
			local isToggled = defaultValue or false
			
			local toggleContainer = UI_FACTORY.CreateBaseElement("Frame", {
				Name = text .. "TOGGLE",
				Size = UDim2.new(1, 0, 0, 20),
				BackgroundTransparency = 1,
				Parent = displayPage
			})
			
			local leftSide = UI_FACTORY.RoundedFrame(5)
			leftSide.Size = UDim2.new(1, -22, 1, 0)
			leftSide.ImageColor3 = COLORS.BACKGROUND.BUTTON
			leftSide.Parent = toggleContainer
			
			local rightSide = UI_FACTORY.RoundedFrame(5)
			rightSide.Position = UDim2.new(1, -20, 0, 0)
			rightSide.Size = UDim2.new(0, 20, 1, 0)
			rightSide.ImageColor3 = COLORS.BACKGROUND.BUTTON_HOVER
			rightSide.Parent = toggleContainer
			
			local statusIndicator = UI_FACTORY.CreateBaseElement("Frame", {
				BackgroundColor3 = isToggled and COLORS.ACCENT.SUCCESS or COLORS.ACCENT.ERROR,
				Position = UDim2.new(1, -22, 0.2, 0),
				Size = UDim2.new(0, 2, 0.6, 0),
				Parent = toggleContainer
			})
			
			local tickIcon = UI_FACTORY.IconElement("TICK")
			tickIcon.ImageTransparency = isToggled and 0 or 1
			tickIcon.Parent = rightSide
			
			local toggleButton = UI_FACTORY.TextElement("TextButton", text, 12, true)
			toggleButton.Name = "ToggleButton"
			toggleButton.Size = UDim2.new(1, 0, 1, 0)
			toggleButton.Parent = leftSide
			
			toggleButton.MouseButton1Down:Connect(function()
				isToggled = not isToggled
				CreateTween(statusIndicator, {BackgroundColor3 = isToggled and COLORS.ACCENT.SUCCESS or COLORS.ACCENT.ERROR})
				CreateTween(tickIcon, {ImageTransparency = isToggled and 0 or 1})
				callback(isToggled)
			end)
			
			local toggleLib = {}
			
			function toggleLib.Set(value)
				isToggled = value
				CreateTween(statusIndicator, {BackgroundColor3 = isToggled and COLORS.ACCENT.SUCCESS or COLORS.ACCENT.ERROR})
				CreateTween(tickIcon, {ImageTransparency = isToggled and 0 or 1})
				callback(isToggled)
			end
			
			return toggleLib
		end
		
		function pageLibrary.AddTextBox(text, placeholder, callback)
			local textBoxContainer = UI_FACTORY.CreateBaseElement("Frame", {
				Name = text .. "TEXTBOX",
				Size = UDim2.new(1, 0, 0, 20),
				BackgroundTransparency = 1,
				Parent = displayPage
			})
			
			local textBoxBackground = UI_FACTORY.RoundedFrame(5)
			textBoxBackground.Name = "TextBoxForeground"
			textBoxBackground.ImageColor3 = COLORS.BACKGROUND.BUTTON
			textBoxBackground.Size = UDim2.new(1, 0, 1, 0)
			textBoxBackground.Parent = textBoxContainer
			
			local textBox = UI_FACTORY.TextElement("TextBox", text, 12)
			textBox.PlaceholderText = placeholder or ""
			textBox.TextTruncate = Enum.TextTruncate.AtEnd
			textBox.Parent = textBoxBackground
			
			textBox.FocusLost:Connect(function(enterPressed)
				if enterPressed then
					callback(textBox.Text)
				end
			end)
		end
		
		return pageLibrary
	end
	
	return tabLibrary
end

return UILibrary